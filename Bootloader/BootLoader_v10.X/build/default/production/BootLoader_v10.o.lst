MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;
                      00002 ; Bootloader for Android Bluetooth / WiFi board
                      00003 ; Written by E.J. van Veldhuizen, 2014
                      00004 ; 
  00000000            00005 bank_option=0
  00000000            00006 page_option=0
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ; Build date : Mar 21 2016
                      00005 ;  MPASM PIC16F1938 processor include
                      00006 ; 
                      00007 ;  (c) Copyright 1999-2016 Microchip Technology, All rights reserved
                      00008 ;==========================================================================
                      00009 
                      01418         LIST
                      00011         LIST
                      00012 
                      00013 ;#define        FAKEINPUT               ; uncomment to have to input data for debugging (see end of file
                            ) 
                      00014 
                      00015 ; SET TABSIZE to 16 (edit/properties/ASM file types)
                      00016 
                      00017 ; Configuration words:    2FA4, 39FE
8007   2FA4           00018         __config        _CONFIG1, (_FOSC_INTOSC & _WDTE_OFF  & _PWRTE_OFF & _MCLRE_OFF & _CP_OFF & _CPD_
                            OFF & _BOREN_ON & _CLKOUTEN_OFF & _IESO_OFF & _FCMEN_ON) & 0x3FFF
8008   39FE           00019         __config        _CONFIG2, (_WRT_BOOT & _PLLEN_ON & _STVREN_OFF & _BORV_HI & _LVP_ON) & 0x3FFF
                      00020 
                      00021 
                      00022 ; ***********************************************************************
                      00023 ; VARIABLES, CONSTANTS AND MACRP DECLARATIONS
                      00024 ; ***********************************************************************
                      00025         cblock 0x20      
  00000020            00026           delaycnt:4                    ; delay conter
  00000024            00027           TEXT_TMP                      ; variables for text output
  00000025            00028           RXDcnt, RXDtmp
  00000027            00029           HEXTADR:2
  00000029            00030           HEXOUT, HEXOUTCNT
  0000002B            00031           fakereadadr:2
                      00032         endc
                      00033 
                      00034         cblock 0x70      
  00000070            00035           HEXADR:2, RXD, RXDl, HEXFADR:2, RXFD:2, TEXT_POS:2, TX_OUT, ERRCNT:2
  0000007D            00036           MISC_STATE    ; bit 0: program (0) or verify (1), 
                      00037                 ; bit 1: hexline for programming
                      00038                 ; bit 2
                      00039                 ; bit 3
                      00040                 ; bit 4: flush bit 0: flush not needed, 1 flush needed
                      00041         endc
                      00042 
                      00043 ; PIN LAYOUT
                      00044 ;
                      00045 ; RA0 - 
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00046 ; RA1 - 
                      00047 ; RA2 - 
                      00048 ; RA3 - 
                      00049 ; RA4 - 
                      00050 ; RA5 - 
                      00051 ; RA6 - 
                      00052 ; RA7 - 
                      00053 ;
                      00054 ; RB0 - LED Yellow
                      00055 ; RB1 - LED Orange 
                      00056 ; RB2 - CPS Button
                      00057 ; RB3 - NTC / Bootloader switch
                      00058 ; RB4 - 
                      00059 ; RB5 - 
                      00060 ; RB6 - 
                      00061 ; RB7 - 
                      00062 ;
                      00063 ; RC0 - 
                      00064 ; RC1 - 
                      00065 ; RC2 - 
                      00066 ; RC3 - 
                      00067 ; RC4 - 
                      00068 ; RC5 - 
                      00069 ; RC6 - Tx
                      00070 ; RC7 - Rx
                      00071 ;
                      00072 ; RE3 - Vpp
                      00073 
                      00074 ; *** MACROS ***
                      00075 
                      00076 ; writetext
                      00077 ;  writes text to TX
                      00078 ;  example: writetext text_OK
                      00079 ;  with:    text_OK:    dt      "OK",.13,.10,0
                      00080 writetext       macro   textlabel
                      00081         load_f16_l16    TEXT_POS, textlabel
                      00082         call    write_text
                      00083         endm
                      00084 
                      00085 uart_write_l    macro   value_l
                      00086         movlw   value_l
                      00087         call    uart_write_w
                      00088         endm
                      00089 
                      00090 uart_write_f    macro   reg
                      00091         movf    ref,w
                      00092         call    uart_write_w
                      00093         endm
                      00094 
                      00095 
                      00096 loadnb_f_l      macro   flag, lit
                      00097         movlw   lit
                      00098         movwf   flag
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00099         endm
                      00100 
                      00101 loadnb_f_f      macro   flag1, flag2
                      00102         movf    flag2, w
                      00103         movwf   flag1
                      00104         endm
                      00105 
                      00106 DoubleC2W       macro   char1, char2
                      00107         dw      (( ((char1 & 0x3F) << 8) | ((char1 & 0x40) << 1) | (char2 & 0x7F) ) & 0x3FFF)
                      00108         endm
                      00109 
                      00110 QuadC2W macro   char1, char2, char3, char4
                      00111         DoubleC2W       char1, char2
                      00112         DoubleC2W       char3, char4
                      00113         endm
                      00114 
                      00115 OctC2W  macro   char1, char2, char3, char4, char5, char6, char7, char8
                      00116         DoubleC2W       char1, char2
                      00117         DoubleC2W       char3, char4
                      00118         DoubleC2W       char5, char6
                      00119         DoubleC2W       char7, char8
                      00120         endm
                      00121 
                      00122 ; ***********************************************************************
                      00123 ; START OF CODE
                      00124 ; ***********************************************************************
                      00125 
0000                  00126         org     0x0000
                      00127 ; ******************************************************************************************************
                            ***********
                      00128 ; *** CHECK BOOTLOADER SELECTED. Set ports to read Port RB2. Delay to stabilize levels
0000                  00129 bootloadcheck   
0000   0021           00130         banksel OPTION_REG
                      00131         loadnb_f_l      OSCCON^80, b'11111000' ; 16 MHz clock (do not use ...11 !) (see ADC Errata on 32
                             MHz)
0001   30F8               M         movlw   b'11111000'
0002   0099               M         movwf   OSCCON^80
0003   2806           00132         goto    init2
                      00133 
0004                  00134 intvector       ; Interupt vector is at 0x004 ; so we have to deal with it
0004   3182           00135         pagesel 0x0204
0005   2A04           00136         goto    0x0204
                      00137         if intvector != 0x0004 
                      00138           error "Interrupt vector not correct! Should be on 0x0004."
                      00139         endif
                      00140 
0006                  00141 init2
                      00142         loadnb_f_l      TRISB^80, b'11111111'   ; PORTB all input
0006   30FF               M         movlw   b'11111111'
0007   008D               M         movwf   TRISB^80
0008   1395           00143         bcf     OPTION_REG^80, 7        ; enable all weak pull up
0009   0023           00144         banksel ANSELB
000A   018D           00145         clrf    ANSELB^180
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000B   0024           00146         banksel WPUB
                      00147         loadnb_f_l      WPUB^200, b'00000100'
000C   3004               M         movlw   b'00000100'
000D   008D               M         movwf   WPUB^200
000E   0020           00148         banksel .0
                      00149 
                      00150         ;DELAY100ms
000F   01A0           00151         clrf    delaycnt                ; delay 91 ms (by result :) )
0010   01A1           00152         clrf    delaycnt+1
0011   3001           00153 del1:   movlw   .1
0012   02A0           00154         subwf   delaycnt,f
0013   3000           00155         movlw   .0
0014   3BA1           00156         subwfb  delaycnt+1,f
0015   1D03           00157         skpz
0016   2811           00158         goto    del1
                      00159 
                      00160         ifndef  FAKEINPUT
                      00161         gotoif_f_b_s    PORTB, 2, 0x0200        ; If bootloader button NOT pressed -> jump to 0x0200
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
                          M          bankset        PORTB
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (PORTB)>=_BANKSIZE
                          M           banksel       PORTB
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((PORTB)<0x70) || ((PORTB)>=0x80)
                          M           banksel       PORTB
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((PORTB)/_BANKSIZE)!=bankblock && (((PORTB)<0x70) || ((PORTB)>=0x80))
                          M bankblock=((PORTB)/_BANKSIZE)
                          M           banksel       PORTB
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0017   190D               M          btfsc  PORTB,2
                          M          gotoc  0x0200
                          M         errorlevel      +306
0018   2A00               M         goto    0x0200
                          M          bankres        PORTB
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (PORTB)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         else
                          M jcnt++
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M          bankset        PORTB
                          M          pageset        j_0_0
                          M          btfss  PORTB,2
                          M          goto   j_0_0
                          M          bankres        PORTB
                          M          pageset        0x0200
                          M          goto   0x0200
                          M j_0_0:
                          M         banklabel
                          M          bankres        PORTB
                          M          pageres
                          M         endif
  00000001                M pgcnt++
                      00162         ;gotoif_f_b_c   PORTB, 2, 0x0200        ; *****************************************************
                      00163         endif
                      00164 
                      00165 ; ******************************************************************************************************
                            ***********
                      00166 ; *** BOOTLOADER is selected, now initialize the ports
                      00167 
0019   140D           00168 init3   bsf     PORTB, 0                ; LED yellow on
001A   0021           00169         banksel TRISB
                      00170         loadnb_f_l      TRISB^80, b'11111110'
001B   30FE               M         movlw   b'11111110'
001C   008D               M         movwf   TRISB^80
                      00171         loadnb_f_l      TRISC^80, b'10111111'   ; set RC as input (RC3 and RC4 as I2C, RC7 as Rx), set T
                            x (RC6) as output
001D   30BF               M         movlw   b'10111111'
001E   008E               M         movwf   TRISC^80
                      00172 
                      00173         ; UART init at 9600 baudrate
                      00174         ; set RC7 (RX), RC6 (TX) to I/O
                      00175         ; 9600 baud @ 16 MHz -> SPBRG = .25
001F   0023           00176         banksel SPBRGH
0020   019C           00177         clrf    SPBRGH^180
                      00178         loadnb_f_l      SPBRGL^180, .25
0021   3019               M         movlw   .25
0022   009B               M         movwf   SPBRGL^180
0023   111E           00179         bcf     TXSTA^180, BRGH;, 0
0024   119F           00180         bcf     BAUDCON^180, BRG16;, 0
                      00181         ; enable TX and RX
                      00182         ; • TXEN = 1 • SYNC = 0 • SPEN = 1
                      00183         ; • CREN = 1 • SYNC = 0 • SPEN = 1
0025   169E           00184         bsf     TXSTA^180, TXEN;, 1
Warning[219]: Invalid RAM location specified.
0026   161D           00185         bsf     RCSTA^180, CREN;, 1
0027   121E           00186         bcf     TXSTA^180, SYNC;, 0
Warning[219]: Invalid RAM location specified.
0028   179D           00187         bsf     RCSTA^180, SPEN;, 1
                      00188 
0029   0020           00189         banksel .0
                      00190         ifdef   FAKEINPUT
                      00191         load_f16_l16    fakereadadr, fakedata
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00192         endif
                      00193 
                      00194 ; ******************************************************************************************************
                            ***********
                      00195 ; *** MAIN loop: print Menu. Read selection (W, V, R or G) and jump to right routine
002A                  00196 mainloop        
                      00197         writetext       text_menu
                          M         load_f16_l16    TEXT_POS, text_menu
                          M         load_f_l        TEXT_POS,(text_menu % 0x100)
002A   30D3               M         movlw   (text_menu % 0x100)
                          M         load_f_w        TEXT_POS
                          M         bankset TEXT_POS
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS)>=_BANKSIZE
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((TEXT_POS)<0x70) || ((TEXT_POS)>=0x80)
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((TEXT_POS)/_BANKSIZE)!=bankblock && (((TEXT_POS)<0x70) || ((TEXT_POS)>=0x80))
                          M bankblock=((TEXT_POS)/_BANKSIZE)
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
002B   00F8               M         movwf   TEXT_POS
                          M         bankres TEXT_POS
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_l        TEXT_POS+1,(text_menu >> .8)
002C   3001               M         movlw   (text_menu >> .8)
                          M         load_f_w        TEXT_POS+1
                          M         bankset TEXT_POS+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS+1)>=_BANKSIZE
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((TEXT_POS+1)<0x70) || ((TEXT_POS+1)>=0x80)
                          M           banksel       TEXT_POS+1
                          M          endif
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         endif
                          M         if      bank_option==2
                          M          if ((TEXT_POS+1)/_BANKSIZE)!=bankblock && (((TEXT_POS+1)<0x70) || ((TEXT_POS+1)>=0x80))
                          M bankblock=((TEXT_POS+1)/_BANKSIZE)
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
002D   00F9               M         movwf   TEXT_POS+1
                          M         bankres TEXT_POS+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS+1)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
002E   2192               M         call    write_text
002F   2165           00198         call    readRXwait              ; read character
                      00199         load_f_f        TX_OUT, RXD             ; echo input
                          M         load_w_f        RXD
                          M     bankset     RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0030   0872               M         movf    RXD,W
                          M         bankres RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_w        TX_OUT
                          M         bankset TX_OUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M          if (TX_OUT)>=_BANKSIZE
                          M           banksel       TX_OUT
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((TX_OUT)<0x70) || ((TX_OUT)>=0x80)
                          M           banksel       TX_OUT
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((TX_OUT)/_BANKSIZE)!=bankblock && (((TX_OUT)<0x70) || ((TX_OUT)>=0x80))
                          M bankblock=((TX_OUT)/_BANKSIZE)
                          M           banksel       TX_OUT
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0031   00FA               M         movwf   TX_OUT
                          M         bankres TX_OUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TX_OUT)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
0032   215E           00200         call    uart_write_TX_OUT       ; write out
0033   21CD           00201         call    write_lf        
                      00202         if_f_eq_l       RXD, 'W'                ; "Write" selected
  00000001                M cdep++
                          M         if cdep>mdep
  00000001                M mdep++
  00000000                M labcnt1        = 0
                          M         endif
  00000001                M labcnt1++
                          M         gotoif_f_ne_l   RXD,'W',lab_1_1
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
0034   3057               M          movlw  'W'
                          M          bankset        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0035   0272               M          subwf  RXD,W
                          M          bankres        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
0036   1D03               M          btfss  STATUS,Z
                          M          gotoc  lab_1_1
                          M         errorlevel      +306
0037   2840               M         goto    lab_1_1
                          M         else
                          M          movlw  'W'
                          M          bankset        RXD
                          M          subwf  RXD,W
                          M          bankres        RXD
                          M          pageset        lab_1_1
                          M          btfss  STATUS,Z
                          M          goto   lab_1_1
                          M          pageres
                          M         endif
  00000002                M pgcnt++
0038   107D           00203          bcf    MISC_STATE,0
0039   20A2           00204          call   readhexfile
                      00205          writetext      text_OK
                          M         load_f16_l16    TEXT_POS, text_OK
                          M         load_f_l        TEXT_POS,(text_OK % 0x100)
003A   30FA               M         movlw   (text_OK % 0x100)
                          M         load_f_w        TEXT_POS
                          M         bankset TEXT_POS
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS)>=_BANKSIZE
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((TEXT_POS)<0x70) || ((TEXT_POS)>=0x80)
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((TEXT_POS)/_BANKSIZE)!=bankblock && (((TEXT_POS)<0x70) || ((TEXT_POS)>=0x80))
                          M bankblock=((TEXT_POS)/_BANKSIZE)
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         errorlevel      -302    ; supress bank bit warning
003B   00F8               M         movwf   TEXT_POS
                          M         bankres TEXT_POS
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_l        TEXT_POS+1,(text_OK >> .8)
003C   3001               M         movlw   (text_OK >> .8)
                          M         load_f_w        TEXT_POS+1
                          M         bankset TEXT_POS+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS+1)>=_BANKSIZE
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((TEXT_POS+1)<0x70) || ((TEXT_POS+1)>=0x80)
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((TEXT_POS+1)/_BANKSIZE)!=bankblock && (((TEXT_POS+1)<0x70) || ((TEXT_POS+1)>=0x80))
                          M bankblock=((TEXT_POS+1)/_BANKSIZE)
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
003D   00F9               M         movwf   TEXT_POS+1
                          M         bankres TEXT_POS+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS+1)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
003E   2192               M         call    write_text
003F   282A           00206          goto   mainloop
                      00207         end_if
0040                      M lab_1_1:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000000                M cdep--
                      00208         if_f_eq_l       RXD, 'V'                ; "Verify" selected
  00000001                M cdep++
                          M         if cdep>mdep
                          M mdep++
                          M labcnt1        = 0
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         endif
  00000002                M labcnt1++
                          M         gotoif_f_ne_l   RXD,'V',lab_1_2
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
0040   3056               M          movlw  'V'
                          M          bankset        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0041   0272               M          subwf  RXD,W
                          M          bankres        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
0042   1D03               M          btfss  STATUS,Z
                          M          gotoc  lab_1_2
                          M         errorlevel      +306
0043   2854               M         goto    lab_1_2
                          M         else
                          M          movlw  'V'
                          M          bankset        RXD
                          M          subwf  RXD,W
                          M          bankres        RXD
                          M          pageset        lab_1_2
                          M          btfss  STATUS,Z
                          M          goto   lab_1_2
                          M          pageres
                          M         endif
  00000003                M pgcnt++
0044   147D           00209          bsf    MISC_STATE,0
0045   01FB           00210          clrf   ERRCNT          ; clear error conter
0046   01FC           00211          clrf   ERRCNT+1
0047   20A2           00212          call   readhexfile
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00213          load_f_f       HEXOUT, ERRCNT+1        ; write counted errors
                          M         load_w_f        ERRCNT+1
                          M     bankset     ERRCNT+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (ERRCNT+1)>=_BANKSIZE
                          M           banksel       ERRCNT+1
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((ERRCNT+1)<0x70) || ((ERRCNT+1)>=0x80)
                          M           banksel       ERRCNT+1
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((ERRCNT+1)/_BANKSIZE)!=bankblock && (((ERRCNT+1)<0x70) || ((ERRCNT+1)>=0x80))
                          M bankblock=((ERRCNT+1)/_BANKSIZE)
                          M           banksel       ERRCNT+1
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0048   087C               M         movf    ERRCNT+1,W
                          M         bankres ERRCNT+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (ERRCNT+1)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_w        HEXOUT
                          M         bankset HEXOUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUT)>=_BANKSIZE
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXOUT)<0x70) || ((HEXOUT)>=0x80)
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXOUT)/_BANKSIZE)!=bankblock && (((HEXOUT)<0x70) || ((HEXOUT)>=0x80))
                          M bankblock=((HEXOUT)/_BANKSIZE)
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0049   00A9               M         movwf   HEXOUT
                          M         bankres HEXOUT
                          M         ;messg  "bank_option= "  #v(bank_option)
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         if      bank_option==0
                          M          if (HEXOUT)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
004A   21BA           00214          call   write_hex
                      00215          load_f_f       HEXOUT, ERRCNT
                          M         load_w_f        ERRCNT
                          M     bankset     ERRCNT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (ERRCNT)>=_BANKSIZE
                          M           banksel       ERRCNT
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((ERRCNT)<0x70) || ((ERRCNT)>=0x80)
                          M           banksel       ERRCNT
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((ERRCNT)/_BANKSIZE)!=bankblock && (((ERRCNT)<0x70) || ((ERRCNT)>=0x80))
                          M bankblock=((ERRCNT)/_BANKSIZE)
                          M           banksel       ERRCNT
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
004B   087B               M         movf    ERRCNT,W
                          M         bankres ERRCNT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (ERRCNT)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_w        HEXOUT
                          M         bankset HEXOUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUT)>=_BANKSIZE
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXOUT)<0x70) || ((HEXOUT)>=0x80)
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXOUT)/_BANKSIZE)!=bankblock && (((HEXOUT)<0x70) || ((HEXOUT)>=0x80))
                          M bankblock=((HEXOUT)/_BANKSIZE)
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
004C   00A9               M         movwf   HEXOUT
                          M         bankres HEXOUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUT)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
004D   21BA           00216          call   write_hex
                      00217          writetext      text_errors
                          M         load_f16_l16    TEXT_POS, text_errors
                          M         load_f_l        TEXT_POS,(text_errors % 0x100)
004E   30F2               M         movlw   (text_errors % 0x100)
                          M         load_f_w        TEXT_POS
                          M         bankset TEXT_POS
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS)>=_BANKSIZE
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((TEXT_POS)<0x70) || ((TEXT_POS)>=0x80)
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((TEXT_POS)/_BANKSIZE)!=bankblock && (((TEXT_POS)<0x70) || ((TEXT_POS)>=0x80))
                          M bankblock=((TEXT_POS)/_BANKSIZE)
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
004F   00F8               M         movwf   TEXT_POS
                          M         bankres TEXT_POS
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_l        TEXT_POS+1,(text_errors >> .8)
0050   3001               M         movlw   (text_errors >> .8)
                          M         load_f_w        TEXT_POS+1
                          M         bankset TEXT_POS+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M          if (TEXT_POS+1)>=_BANKSIZE
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((TEXT_POS+1)<0x70) || ((TEXT_POS+1)>=0x80)
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((TEXT_POS+1)/_BANKSIZE)!=bankblock && (((TEXT_POS+1)<0x70) || ((TEXT_POS+1)>=0x80))
                          M bankblock=((TEXT_POS+1)/_BANKSIZE)
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0051   00F9               M         movwf   TEXT_POS+1
                          M         bankres TEXT_POS+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS+1)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
0052   2192               M         call    write_text
0053   282A           00218          goto   mainloop
                      00219         end_if
0054                      M lab_1_2:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000000                M cdep--
                      00220         if_f_eq_l       RXD, 'R'                ; "Read" selected
  00000001                M cdep++
                          M         if cdep>mdep
                          M mdep++
                          M labcnt1        = 0
                          M         endif
  00000003                M labcnt1++
                          M         gotoif_f_ne_l   RXD,'R',lab_1_3
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
0054   3052               M          movlw  'R'
                          M          bankset        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0055   0272               M          subwf  RXD,W
                          M          bankres        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
0056   1D03               M          btfss  STATUS,Z
                          M          gotoc  lab_1_3
                          M         errorlevel      +306
0057   285A               M         goto    lab_1_3
                          M         else
                          M          movlw  'R'
                          M          bankset        RXD
                          M          subwf  RXD,W
                          M          bankres        RXD
                          M          pageset        lab_1_3
                          M          btfss  STATUS,Z
                          M          goto   lab_1_3
                          M          pageres
                          M         endif
  00000004                M pgcnt++
0058   2066           00221          call   readprogram
0059   282A           00222          goto   mainloop
                      00223         end_if
005A                      M lab_1_3:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000000                M cdep--
                      00224         if_f_eq_l       RXD, 'G'                ; "Go" selected
  00000001                M cdep++
                          M         if cdep>mdep
                          M mdep++
                          M labcnt1        = 0
                          M         endif
  00000004                M labcnt1++
                          M         gotoif_f_ne_l   RXD,'G',lab_1_4
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
005A   3047               M          movlw  'G'
                          M          bankset        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
005B   0272               M          subwf  RXD,W
                          M          bankres        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
005C   1D03               M          btfss  STATUS,Z
                          M          gotoc  lab_1_4
                          M         errorlevel      +306
005D   2865               M         goto    lab_1_4
                          M         else
                          M          movlw  'G'
                          M          bankset        RXD
                          M          subwf  RXD,W
                          M          bankres        RXD
                          M          pageset        lab_1_4
                          M          btfss  STATUS,Z
                          M          goto   lab_1_4
                          M          pageres
                          M         endif
  00000005                M pgcnt++
005E   018D           00225          clrf   PORTB           ; LED off
                      00226          writetext      text_bye
                          M         load_f16_l16    TEXT_POS, text_bye
                          M         load_f_l        TEXT_POS,(text_bye % 0x100)
005F   30FC               M         movlw   (text_bye % 0x100)
                          M         load_f_w        TEXT_POS
                          M         bankset TEXT_POS
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS)>=_BANKSIZE
                          M           banksel       TEXT_POS
                          M          endif
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         endif
                          M         if      bank_option==1
                          M          if ((TEXT_POS)<0x70) || ((TEXT_POS)>=0x80)
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((TEXT_POS)/_BANKSIZE)!=bankblock && (((TEXT_POS)<0x70) || ((TEXT_POS)>=0x80))
                          M bankblock=((TEXT_POS)/_BANKSIZE)
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0060   00F8               M         movwf   TEXT_POS
                          M         bankres TEXT_POS
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_l        TEXT_POS+1,(text_bye >> .8)
0061   3001               M         movlw   (text_bye >> .8)
                          M         load_f_w        TEXT_POS+1
                          M         bankset TEXT_POS+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS+1)>=_BANKSIZE
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((TEXT_POS+1)<0x70) || ((TEXT_POS+1)>=0x80)
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((TEXT_POS+1)/_BANKSIZE)!=bankblock && (((TEXT_POS+1)<0x70) || ((TEXT_POS+1)>=0x80))
                          M bankblock=((TEXT_POS+1)/_BANKSIZE)
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0062   00F9               M         movwf   TEXT_POS+1
                          M         bankres TEXT_POS+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS+1)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0063   2192               M         call    write_text
0064   2A00           00227          goto   0x0200
                      00228         end_if
0065                      M lab_1_4:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000000                M cdep--
0065   282A           00229         goto    mainloop
                      00230 
                      00231 ; ******************************************************************************************************
                            ***********
                      00232 ; *** READPROGRAM. Reads the flash memory and prints the values. 
                      00233 ;        If more than 4 empty (0x3FFF) values, do not print. Print the last FLASH location
0066                  00234 readprogram
                      00235         load_f_l        HEXOUTCNT,.5
0066   3005               M         movlw   .5
                          M         load_f_w        HEXOUTCNT
                          M         bankset HEXOUTCNT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUTCNT)>=_BANKSIZE
                          M           banksel       HEXOUTCNT
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXOUTCNT)<0x70) || ((HEXOUTCNT)>=0x80)
                          M           banksel       HEXOUTCNT
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXOUTCNT)/_BANKSIZE)!=bankblock && (((HEXOUTCNT)<0x70) || ((HEXOUTCNT)>=0x80))
                          M bankblock=((HEXOUTCNT)/_BANKSIZE)
                          M           banksel       HEXOUTCNT
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0067   00AA               M         movwf   HEXOUTCNT
                          M         bankres HEXOUTCNT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUTCNT)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                      00236         load_f16_l16    HEXADR, 0x0200          ; start at address 0x0200
                          M         load_f_l        HEXADR,(0x0200 % 0x100)
0068   3000               M         movlw   (0x0200 % 0x100)
                          M         load_f_w        HEXADR
                          M         bankset HEXADR
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXADR)>=_BANKSIZE
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M           banksel       HEXADR
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXADR)<0x70) || ((HEXADR)>=0x80)
                          M           banksel       HEXADR
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXADR)/_BANKSIZE)!=bankblock && (((HEXADR)<0x70) || ((HEXADR)>=0x80))
                          M bankblock=((HEXADR)/_BANKSIZE)
                          M           banksel       HEXADR
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0069   00F0               M         movwf   HEXADR
                          M         bankres HEXADR
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXADR)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_l        HEXADR+1,(0x0200 >> .8)
006A   3002               M         movlw   (0x0200 >> .8)
                          M         load_f_w        HEXADR+1
                          M         bankset HEXADR+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXADR+1)>=_BANKSIZE
                          M           banksel       HEXADR+1
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXADR+1)<0x70) || ((HEXADR+1)>=0x80)
                          M           banksel       HEXADR+1
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXADR+1)/_BANKSIZE)!=bankblock && (((HEXADR+1)<0x70) || ((HEXADR+1)>=0x80))
                          M bankblock=((HEXADR+1)/_BANKSIZE)
                          M           banksel       HEXADR+1
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
006B   00F1               M         movwf   HEXADR+1
                          M         bankres HEXADR+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXADR+1)>=_BANKSIZE
                          M           banksel       0
                          M          endif
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         endif
                          M         errorlevel      +302
006C   2105           00237 rdp1:   call    readPFlash
                      00238 
006D   0023           00239         banksel EEDATH          ; check if data 0x3FFF
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
006E   0814           00240         movf    EEDATH,w
006F   0020           00241         banksel .0
0070   3C3F           00242         sublw   0x3F
0071   1D03           00243         skpz
0072   289F           00244         goto    rdp3
0073   0023           00245         banksel EEDATL
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0074   0813           00246         movf    EEDATL,w
0075   0020           00247         banksel .0
0076   3CFF           00248         sublw   0xFF
0077   1D03           00249         skpz
0078   289F           00250         goto    rdp3            ; not empty, reset counter to 4
0079   0BAA           00251         decfsz  HEXOUTCNT,f             ; already 4 times 0x3FFF?
007A   2884           00252         goto    rdp2
007B   0AAA           00253         incf    HEXOUTCNT,f             ; increase for next round
007C   30FF           00254         movlw   0xFF            ; print last address 0x3FFF
007D   0270           00255         subwf   HEXADR,w
007E   1D03           00256         skpz
007F   2896           00257         goto    rdp4
0080   303F           00258         movlw   0x3F
0081   0271           00259         subwf   HEXADR+1,w
0082   1D03           00260         skpz
0083   2896           00261         goto    rdp4
                      00262         
                      00263 rdp2:   load_f_f        HEXOUT, HEXADR+1        ; write out address - data
                          M         load_w_f        HEXADR+1
                          M     bankset     HEXADR+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXADR+1)>=_BANKSIZE
                          M           banksel       HEXADR+1
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXADR+1)<0x70) || ((HEXADR+1)>=0x80)
                          M           banksel       HEXADR+1
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXADR+1)/_BANKSIZE)!=bankblock && (((HEXADR+1)<0x70) || ((HEXADR+1)>=0x80))
                          M bankblock=((HEXADR+1)/_BANKSIZE)
                          M           banksel       HEXADR+1
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0084   0871               M         movf    HEXADR+1,W
                          M         bankres HEXADR+1
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXADR+1)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_w        HEXOUT
                          M         bankset HEXOUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUT)>=_BANKSIZE
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXOUT)<0x70) || ((HEXOUT)>=0x80)
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXOUT)/_BANKSIZE)!=bankblock && (((HEXOUT)<0x70) || ((HEXOUT)>=0x80))
                          M bankblock=((HEXOUT)/_BANKSIZE)
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0085   00A9               M         movwf   HEXOUT
                          M         bankres HEXOUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUT)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
0086   21BA           00264         call    write_hex
                      00265         load_f_f        HEXOUT, HEXADR
                          M         load_w_f        HEXADR
                          M     bankset     HEXADR
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXADR)>=_BANKSIZE
                          M           banksel       HEXADR
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXADR)<0x70) || ((HEXADR)>=0x80)
                          M           banksel       HEXADR
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXADR)/_BANKSIZE)!=bankblock && (((HEXADR)<0x70) || ((HEXADR)>=0x80))
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M bankblock=((HEXADR)/_BANKSIZE)
                          M           banksel       HEXADR
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0087   0870               M         movf    HEXADR,W
                          M         bankres HEXADR
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXADR)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_w        HEXOUT
                          M         bankset HEXOUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUT)>=_BANKSIZE
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXOUT)<0x70) || ((HEXOUT)>=0x80)
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXOUT)/_BANKSIZE)!=bankblock && (((HEXOUT)<0x70) || ((HEXOUT)>=0x80))
                          M bankblock=((HEXOUT)/_BANKSIZE)
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0088   00A9               M         movwf   HEXOUT
                          M         bankres HEXOUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUT)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
0089   21BA           00266         call    write_hex
008A   21D0           00267         call    write_space
                      00268         load_f_f        HEXOUT, EEDATH
                          M         load_w_f        EEDATH
                          M     bankset     EEDATH
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (EEDATH)>=_BANKSIZE
008B   0023               M           banksel       EEDATH
                          M          endif
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         endif
                          M         if      bank_option==1
                          M          if ((EEDATH)<0x70) || ((EEDATH)>=0x80)
                          M           banksel       EEDATH
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((EEDATH)/_BANKSIZE)!=bankblock && (((EEDATH)<0x70) || ((EEDATH)>=0x80))
                          M bankblock=((EEDATH)/_BANKSIZE)
                          M           banksel       EEDATH
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
008C   0814               M         movf    EEDATH,W
                          M         bankres EEDATH
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (EEDATH)>=_BANKSIZE
008D   0020               M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_w        HEXOUT
                          M         bankset HEXOUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUT)>=_BANKSIZE
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXOUT)<0x70) || ((HEXOUT)>=0x80)
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXOUT)/_BANKSIZE)!=bankblock && (((HEXOUT)<0x70) || ((HEXOUT)>=0x80))
                          M bankblock=((HEXOUT)/_BANKSIZE)
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
008E   00A9               M         movwf   HEXOUT
                          M         bankres HEXOUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUT)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
008F   21BA           00269         call    write_hex
                      00270         load_f_f        HEXOUT, EEDATL
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         load_w_f        EEDATL
                          M     bankset     EEDATL
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (EEDATL)>=_BANKSIZE
0090   0023               M           banksel       EEDATL
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((EEDATL)<0x70) || ((EEDATL)>=0x80)
                          M           banksel       EEDATL
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((EEDATL)/_BANKSIZE)!=bankblock && (((EEDATL)<0x70) || ((EEDATL)>=0x80))
                          M bankblock=((EEDATL)/_BANKSIZE)
                          M           banksel       EEDATL
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0091   0813               M         movf    EEDATL,W
                          M         bankres EEDATL
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (EEDATL)>=_BANKSIZE
0092   0020               M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_w        HEXOUT
                          M         bankset HEXOUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUT)>=_BANKSIZE
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXOUT)<0x70) || ((HEXOUT)>=0x80)
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXOUT)/_BANKSIZE)!=bankblock && (((HEXOUT)<0x70) || ((HEXOUT)>=0x80))
                          M bankblock=((HEXOUT)/_BANKSIZE)
                          M           banksel       HEXOUT
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0093   00A9               M         movwf   HEXOUT
                          M         bankres HEXOUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M          if (HEXOUT)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
0094   21BA           00271         call    write_hex
0095   21CD           00272         call    write_lf
                      00273          
0096   3001           00274 rdp4    movlw   .1              ; increase HEXADR
0097   07F0           00275         addwf   HEXADR,f
0098   3000           00276         movlw   .0
0099   3DF1           00277         addwfc  HEXADR+1,f
                      00278         
009A   0871           00279         movf    HEXADR+1,w              ; at end (0x4000)?
009B   3C40           00280         sublw   0x40
009C   1D03           00281         skpz
009D   286C           00282         goto    rdp1
009E   0008           00283         return
                      00284 
                      00285 rdp3    load_f_l        HEXOUTCNT,.5            ; set back at 4 times 
009F   3005               M         movlw   .5
                          M         load_f_w        HEXOUTCNT
                          M         bankset HEXOUTCNT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUTCNT)>=_BANKSIZE
                          M           banksel       HEXOUTCNT
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXOUTCNT)<0x70) || ((HEXOUTCNT)>=0x80)
                          M           banksel       HEXOUTCNT
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXOUTCNT)/_BANKSIZE)!=bankblock && (((HEXOUTCNT)<0x70) || ((HEXOUTCNT)>=0x80))
                          M bankblock=((HEXOUTCNT)/_BANKSIZE)
                          M           banksel       HEXOUTCNT
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00A0   00AA               M         movwf   HEXOUTCNT
                          M         bankres HEXOUTCNT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXOUTCNT)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
00A1   2884           00286         goto    rdp2
                      00287 
                      00288 ; ******************************************************************************************************
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            ***********
                      00289 ; *** READHEXFILE. This routine programs or verifies the flash memory by reading the HEX file
00A2                  00290 readhexfile     ;call   write_lf
                      00291         writetext       text_hexfile
                          M         load_f16_l16    TEXT_POS, text_hexfile
                          M         load_f_l        TEXT_POS,(text_hexfile % 0x100)
00A2   30E5               M         movlw   (text_hexfile % 0x100)
                          M         load_f_w        TEXT_POS
                          M         bankset TEXT_POS
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS)>=_BANKSIZE
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((TEXT_POS)<0x70) || ((TEXT_POS)>=0x80)
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((TEXT_POS)/_BANKSIZE)!=bankblock && (((TEXT_POS)<0x70) || ((TEXT_POS)>=0x80))
                          M bankblock=((TEXT_POS)/_BANKSIZE)
                          M           banksel       TEXT_POS
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00A3   00F8               M         movwf   TEXT_POS
                          M         bankres TEXT_POS
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_l        TEXT_POS+1,(text_hexfile >> .8)
00A4   3001               M         movlw   (text_hexfile >> .8)
                          M         load_f_w        TEXT_POS+1
                          M         bankset TEXT_POS+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS+1)>=_BANKSIZE
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((TEXT_POS+1)<0x70) || ((TEXT_POS+1)>=0x80)
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((TEXT_POS+1)/_BANKSIZE)!=bankblock && (((TEXT_POS+1)<0x70) || ((TEXT_POS+1)>=0x80))
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M bankblock=((TEXT_POS+1)/_BANKSIZE)
                          M           banksel       TEXT_POS+1
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00A5   00F9               M         movwf   TEXT_POS+1
                          M         bankres TEXT_POS+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TEXT_POS+1)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
00A6   2192               M         call    write_text
                      00292         ;bcf    MISC_STATE, 3           ; flag for segment
                      00293         ;bcf    MISC_STATE, 4           ; flag for not flushed yet
                      00294         ;bcf    MISC_STATE, 5           ; flag to flush
                      00295         ;bcf    MISC_STATE, 6           ; flag for verify error
00A7   3087           00296         movlw   b'10000111'
00A8   05FD           00297         andwf   MISC_STATE,f
00A9                  00298 rhf4:
00A9   2165           00299 rhf2:   call    readRXwait
                      00300         gotoif_f_ne_l   RXD, ':', rhf2          ; wait for start character
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
00AA   303A               M          movlw  ':'
                          M          bankset        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00AB   0272               M          subwf  RXD,W
                          M          bankres        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         endif
                          M         errorlevel      +302
00AC   1D03               M          btfss  STATUS,Z
                          M          gotoc  rhf2
                          M         errorlevel      +306
00AD   28A9               M         goto    rhf2
                          M         else
                          M          movlw  ':'
                          M          bankset        RXD
                          M          subwf  RXD,W
                          M          bankres        RXD
                          M          pageset        rhf2
                          M          btfss  STATUS,Z
                          M          goto   rhf2
                          M          pageres
                          M         endif
  00000006                M pgcnt++
00AE   2189           00301         call    readhexbyteRXwait       ; number of bytes
                      00302         load_f_f        RXDcnt, RXD
                          M         load_w_f        RXD
                          M     bankset     RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00AF   0872               M         movf    RXD,W
                          M         bankres RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_w        RXDcnt
                          M         bankset RXDcnt
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXDcnt)>=_BANKSIZE
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M           banksel       RXDcnt
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXDcnt)<0x70) || ((RXDcnt)>=0x80)
                          M           banksel       RXDcnt
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXDcnt)/_BANKSIZE)!=bankblock && (((RXDcnt)<0x70) || ((RXDcnt)>=0x80))
                          M bankblock=((RXDcnt)/_BANKSIZE)
                          M           banksel       RXDcnt
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00B0   00A5               M         movwf   RXDcnt
                          M         bankres RXDcnt
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXDcnt)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
00B1   1003           00303         clrc                    ; divide by 2: 16 bits values are written
00B2   0CA5           00304         rrf     RXDcnt,f
00B3   2189           00305         call    readhexbyteRXwait       ; high byte of address
                      00306         load_f_f        HEXADR+1, RXD
                          M         load_w_f        RXD
                          M     bankset     RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00B4   0872               M         movf    RXD,W
                          M         bankres RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_w        HEXADR+1
                          M         bankset HEXADR+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXADR+1)>=_BANKSIZE
                          M           banksel       HEXADR+1
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXADR+1)<0x70) || ((HEXADR+1)>=0x80)
                          M           banksel       HEXADR+1
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXADR+1)/_BANKSIZE)!=bankblock && (((HEXADR+1)<0x70) || ((HEXADR+1)>=0x80))
                          M bankblock=((HEXADR+1)/_BANKSIZE)
                          M           banksel       HEXADR+1
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00B5   00F1               M         movwf   HEXADR+1
                          M         bankres HEXADR+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXADR+1)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
00B6   2189           00307         call    readhexbyteRXwait       ; low byte of address
                      00308         load_f_f        HEXADR, RXD
                          M         load_w_f        RXD
                          M     bankset     RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00B7   0872               M         movf    RXD,W
                          M         bankres RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_w        HEXADR
                          M         bankset HEXADR
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXADR)>=_BANKSIZE
                          M           banksel       HEXADR
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXADR)<0x70) || ((HEXADR)>=0x80)
                          M           banksel       HEXADR
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXADR)/_BANKSIZE)!=bankblock && (((HEXADR)<0x70) || ((HEXADR)>=0x80))
                          M bankblock=((HEXADR)/_BANKSIZE)
                          M           banksel       HEXADR
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00B8   00F0               M         movwf   HEXADR
                          M         bankres HEXADR
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXADR)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
00B9   1003           00309         clrc                    ; divide by 2: 16 bits values are written
00BA   0CF1           00310         rrf     HEXADR+1,f
00BB   0CF0           00311         rrf     HEXADR,f
00BC   2189           00312         call    readhexbyteRXwait       ; record type: if 0x00 then data, if 0x01: end of file
00BD   10FD           00313         bcf     MISC_STATE, 1
00BE   117D           00314         bcf     MISC_STATE, 2
                      00315         if_f_eq_l       RXD, 0x00               ; record type is data
  00000001                M cdep++
                          M         if cdep>mdep
                          M mdep++
                          M labcnt1        = 0
                          M         endif
  00000005                M labcnt1++
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         gotoif_f_ne_l   RXD,0x00,lab_1_5
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
00BF   3000               M          movlw  0x00
                          M          bankset        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00C0   0272               M          subwf  RXD,W
                          M          bankres        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
00C1   1D03               M          btfss  STATUS,Z
                          M          gotoc  lab_1_5
                          M         errorlevel      +306
00C2   28CD               M         goto    lab_1_5
                          M         else
                          M          movlw  0x00
                          M          bankset        RXD
                          M          subwf  RXD,W
                          M          bankres        RXD
                          M          pageset        lab_1_5
                          M          btfss  STATUS,Z
                          M          goto   lab_1_5
                          M          pageres
                          M         endif
  00000007                M pgcnt++
                      00316           loadnb_f_f    HEXTADR+1, HEXADR+1     ; save HEXADR for flush
00C3   0871               M         movf    HEXADR+1, w
00C4   00A8               M         movwf   HEXTADR+1
                      00317           loadnb_f_f    HEXTADR, HEXADR
00C5   0870               M         movf    HEXADR, w
00C6   00A7               M         movwf   HEXTADR
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00C7   2139           00318           call  checkFlushData          ; check whether change in ..1F segment 
00C8   14FD           00319           bsf   MISC_STATE,1
                      00320           loadnb_f_f    HEXADR+1, HEXTADR+1     ; restore HEXADR for flush
00C9   0828               M         movf    HEXTADR+1, w
00CA   00F1               M         movwf   HEXADR+1
                      00321           loadnb_f_f    HEXADR, HEXTADR
00CB   0827               M         movf    HEXTADR, w
00CC   00F0               M         movwf   HEXADR
                      00322         end_if 
00CD                      M lab_1_5:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000000                M cdep--
                      00323         if_f_eq_l       RXD, 0x04               ; record type is segment
  00000001                M cdep++
                          M         if cdep>mdep
                          M mdep++
                          M labcnt1        = 0
                          M         endif
  00000006                M labcnt1++
                          M         gotoif_f_ne_l   RXD,0x04,lab_1_6
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
00CD   3004               M          movlw  0x04
                          M          bankset        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00CE   0272               M          subwf  RXD,W
                          M          bankres        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
00CF   1D03               M          btfss  STATUS,Z
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M          gotoc  lab_1_6
                          M         errorlevel      +306
00D0   28D3               M         goto    lab_1_6
                          M         else
                          M          movlw  0x04
                          M          bankset        RXD
                          M          subwf  RXD,W
                          M          bankres        RXD
                          M          pageset        lab_1_6
                          M          btfss  STATUS,Z
                          M          goto   lab_1_6
                          M          pageres
                          M         endif
  00000008                M pgcnt++
00D1   2142           00324           call  checkFlush
00D2   157D           00325           bsf   MISC_STATE,2
                      00326         end_if 
00D3                      M lab_1_6:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000000                M cdep--
                      00327         if_f_eq_l       RXD, 0x01               ; record type is end of file
  00000001                M cdep++
                          M         if cdep>mdep
                          M mdep++
                          M labcnt1        = 0
                          M         endif
  00000007                M labcnt1++
                          M         gotoif_f_ne_l   RXD,0x01,lab_1_7
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
00D3   3001               M          movlw  0x01
                          M          bankset        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00D4   0272               M          subwf  RXD,W
                          M          bankres        RXD
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
00D5   1D03               M          btfss  STATUS,Z
                          M          gotoc  lab_1_7
                          M         errorlevel      +306
00D6   28DB               M         goto    lab_1_7
                          M         else
                          M          movlw  0x01
                          M          bankset        RXD
                          M          subwf  RXD,W
                          M          bankres        RXD
                          M          pageset        lab_1_7
                          M          btfss  STATUS,Z
                          M          goto   lab_1_7
                          M          pageres
                          M         endif
  00000009                M pgcnt++
00D7   2142           00328           call  checkFlush
00D8   2165           00329           call  readRXwait              ; read last two hex coded and lf
00D9   2165           00330           call  readRXwait
00DA   2965           00331           goto  readRXwait
                      00332           ;return
                      00333         end_if 
00DB                      M lab_1_7:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000000                M cdep--
00DB                  00334 rhf1:
                      00335                                 ; read the bytes
00DB   2189           00336         call    readhexbyteRXwait       ; low databyte
                      00337         load_f_f        RXDl, RXD
                          M         load_w_f        RXD
                          M     bankset     RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00DC   0872               M         movf    RXD,W
                          M         bankres RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_w        RXDl
                          M         bankset RXDl
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXDl)>=_BANKSIZE
                          M           banksel       RXDl
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXDl)<0x70) || ((RXDl)>=0x80)
                          M           banksel       RXDl
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXDl)/_BANKSIZE)!=bankblock && (((RXDl)<0x70) || ((RXDl)>=0x80))
                          M bankblock=((RXDl)/_BANKSIZE)
                          M           banksel       RXDl
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00DD   00F3               M         movwf   RXDl
                          M         bankres RXDl
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXDl)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
00DE   2189           00338         call    readhexbyteRXwait       ; high databyte
                      00339         gotoif_f_b_c    MISC_STATE,1,rhf3       ; skip if recordtype is wrong
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
                          M          bankset        MISC_STATE
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (MISC_STATE)>=_BANKSIZE
                          M           banksel       MISC_STATE
                          M          endif
                          M         endif
                          M         if      bank_option==1
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M          if ((MISC_STATE)<0x70) || ((MISC_STATE)>=0x80)
                          M           banksel       MISC_STATE
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((MISC_STATE)/_BANKSIZE)!=bankblock && (((MISC_STATE)<0x70) || ((MISC_STATE)>=0x80))
                          M bankblock=((MISC_STATE)/_BANKSIZE)
                          M           banksel       MISC_STATE
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00DF   1CFD               M          btfss  MISC_STATE,1
                          M          gotoc  rhf3
                          M         errorlevel      +306
00E0   28F8               M         goto    rhf3
                          M          bankres        MISC_STATE
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (MISC_STATE)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         else
                          M jcnt++
                          M          bankset        MISC_STATE
                          M          pageset        j_0_0
                          M          btfsc  MISC_STATE,1
                          M          goto   j_0_0
                          M          bankres        MISC_STATE
                          M          pageset        rhf3
                          M          goto   rhf3
                          M j_0_0:
                          M         banklabel
                          M          bankres        MISC_STATE
                          M          pageres
                          M         endif
  0000000A                M pgcnt++
                      00340         gotoif_f_b_c    MISC_STATE,3,rhf3       ; skip if segment is wrong
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
                          M          bankset        MISC_STATE
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (MISC_STATE)>=_BANKSIZE
                          M           banksel       MISC_STATE
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((MISC_STATE)<0x70) || ((MISC_STATE)>=0x80)
                          M           banksel       MISC_STATE
                          M          endif
                          M         endif
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         if      bank_option==2
                          M          if ((MISC_STATE)/_BANKSIZE)!=bankblock && (((MISC_STATE)<0x70) || ((MISC_STATE)>=0x80))
                          M bankblock=((MISC_STATE)/_BANKSIZE)
                          M           banksel       MISC_STATE
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00E1   1DFD               M          btfss  MISC_STATE,3
                          M          gotoc  rhf3
                          M         errorlevel      +306
00E2   28F8               M         goto    rhf3
                          M          bankres        MISC_STATE
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (MISC_STATE)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         else
                          M jcnt++
                          M          bankset        MISC_STATE
                          M          pageset        j_0_0
                          M          btfsc  MISC_STATE,3
                          M          goto   j_0_0
                          M          bankres        MISC_STATE
                          M          pageset        rhf3
                          M          goto   rhf3
                          M j_0_0:
                          M         banklabel
                          M          bankres        MISC_STATE
                          M          pageres
                          M         endif
  0000000B                M pgcnt++
                      00341         if_f_b_c        MISC_STATE,0            ; Write (not Verify)
  00000001                M cdep++
                          M         if cdep>mdep
                          M mdep++
                          M labcnt1        = 0
                          M         endif
  00000008                M labcnt1++
                          M         gotoif_f_b_s    MISC_STATE,0,lab_1_8
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
                          M          bankset        MISC_STATE
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (MISC_STATE)>=_BANKSIZE
                          M           banksel       MISC_STATE
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((MISC_STATE)<0x70) || ((MISC_STATE)>=0x80)
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M           banksel       MISC_STATE
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((MISC_STATE)/_BANKSIZE)!=bankblock && (((MISC_STATE)<0x70) || ((MISC_STATE)>=0x80))
                          M bankblock=((MISC_STATE)/_BANKSIZE)
                          M           banksel       MISC_STATE
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00E3   187D               M          btfsc  MISC_STATE,0
                          M          gotoc  lab_1_8
                          M         errorlevel      +306
00E4   28E7               M         goto    lab_1_8
                          M          bankres        MISC_STATE
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (MISC_STATE)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         else
                          M jcnt++
                          M          bankset        MISC_STATE
                          M          pageset        j_0_0
                          M          btfss  MISC_STATE,0
                          M          goto   j_0_0
                          M          bankres        MISC_STATE
                          M          pageset        lab_1_8
                          M          goto   lab_1_8
                          M j_0_0:
                          M         banklabel
                          M          bankres        MISC_STATE
                          M          pageres
                          M         endif
  0000000C                M pgcnt++
00E5   214F           00342          call   writeRXDtoflash
                      00343         else_                   ; Verify (not Write)
                          M         gotop   lab_1_9
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
                          M          gotoc  lab_1_9
                          M         errorlevel      +306
00E6   28F8               M         goto    lab_1_9
                          M         else
                          M          pageset        lab_1_9
                          M          goto   lab_1_9
                          M          pageres
                          M         endif
  0000000D                M pgcnt++
00E7                      M lab_1_8:
                          M         banklabel
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  FFFFFFFF                M bankblock=-1
  00000009                M labcnt1++
00E7   2105           00344          call   readPFlash
                      00345          load_w_f       EEDATH          ; compare
                          M     bankset     EEDATH
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (EEDATH)>=_BANKSIZE
00E8   0023               M           banksel       EEDATH
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((EEDATH)<0x70) || ((EEDATH)>=0x80)
                          M           banksel       EEDATH
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((EEDATH)/_BANKSIZE)!=bankblock && (((EEDATH)<0x70) || ((EEDATH)>=0x80))
                          M bankblock=((EEDATH)/_BANKSIZE)
                          M           banksel       EEDATH
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00E9   0814               M         movf    EEDATH,W
                          M         bankres EEDATH
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (EEDATH)>=_BANKSIZE
00EA   0020               M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
00EB   0272           00346          subwf  RXD,w
00EC   1D03           00347          skpz
00ED   28F4           00348          goto   rhf5
                      00349          load_w_f       EEDATL
                          M     bankset     EEDATL
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (EEDATL)>=_BANKSIZE
00EE   0023               M           banksel       EEDATL
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((EEDATL)<0x70) || ((EEDATL)>=0x80)
                          M           banksel       EEDATL
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((EEDATL)/_BANKSIZE)!=bankblock && (((EEDATL)<0x70) || ((EEDATL)>=0x80))
                          M bankblock=((EEDATL)/_BANKSIZE)
                          M           banksel       EEDATL
                          M          endif
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 42


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00EF   0813               M         movf    EEDATL,W
                          M         bankres EEDATL
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (EEDATL)>=_BANKSIZE
00F0   0020               M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
00F1   0273           00350          subwf  RXDl,w
00F2   1903           00351          skpnz
00F3   28F8           00352          goto   rhf3
00F4   3001           00353 rhf5:    movlw  .1              ; error detected: add 1 to ERRCNT
00F5   07FB           00354          addwf  ERRCNT,f
00F6   3000           00355          movlw  .0
00F7   3DFC           00356          addwfc ERRCNT+1,f
                      00357         end_if
00F8                      M lab_1_9:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000000                M cdep--
                      00358 
00F8   0AF0           00359 rhf3:   incf    HEXADR,f                ; assume no 0xFF boundary
00F9   0BA5           00360         decfsz  RXDcnt,f
00FA   28DB           00361         goto    rhf1
                      00362         if_f_b_s        MISC_STATE,2    ; record type = 2
  00000001                M cdep++
                          M         if cdep>mdep
                          M mdep++
                          M labcnt1        = 0
                          M         endif
  0000000A                M labcnt1++
                          M         gotoif_f_b_c    MISC_STATE,2,lab_1_10
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
                          M          bankset        MISC_STATE
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (MISC_STATE)>=_BANKSIZE
                          M           banksel       MISC_STATE
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((MISC_STATE)<0x70) || ((MISC_STATE)>=0x80)
                          M           banksel       MISC_STATE
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((MISC_STATE)/_BANKSIZE)!=bankblock && (((MISC_STATE)<0x70) || ((MISC_STATE)>=0x80))
                          M bankblock=((MISC_STATE)/_BANKSIZE)
                          M           banksel       MISC_STATE
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 43


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00FB   1D7D               M          btfss  MISC_STATE,2
                          M          gotoc  lab_1_10
                          M         errorlevel      +306
00FC   2904               M         goto    lab_1_10
                          M          bankres        MISC_STATE
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (MISC_STATE)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         else
                          M jcnt++
                          M          bankset        MISC_STATE
                          M          pageset        j_0_0
                          M          btfsc  MISC_STATE,2
                          M          goto   j_0_0
                          M          bankres        MISC_STATE
                          M          pageset        lab_1_10
                          M          goto   lab_1_10
                          M j_0_0:
                          M         banklabel
                          M          bankres        MISC_STATE
                          M          pageres
                          M         endif
  0000000E                M pgcnt++
                      00363           if_f_eq_l     RXD,0x00        ; code segment
  00000002                M cdep++
                          M         if cdep>mdep
  00000002                M mdep++
  00000000                M labcnt2        = 0
                          M         endif
  00000001                M labcnt2++
                          M         gotoif_f_ne_l   RXD,0x00,lab_2_1
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
00FD   3000               M          movlw  0x00
                          M          bankset        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 44


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
00FE   0272               M          subwf  RXD,W
                          M          bankres        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
00FF   1D03               M          btfss  STATUS,Z
                          M          gotoc  lab_2_1
                          M         errorlevel      +306
0100   2903               M         goto    lab_2_1
                          M         else
                          M          movlw  0x00
                          M          bankset        RXD
                          M          subwf  RXD,W
                          M          bankres        RXD
                          M          pageset        lab_2_1
                          M          btfss  STATUS,Z
                          M          goto   lab_2_1
                          M          pageres
                          M         endif
  0000000F                M pgcnt++
0101   15FD           00364             bsf MISC_STATE,3
                      00365           else_
                          M         gotop   lab_2_2
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
                          M          gotoc  lab_2_2
                          M         errorlevel      +306
0102   2904               M         goto    lab_2_2
                          M         else
                          M          pageset        lab_2_2
                          M          goto   lab_2_2
                          M          pageres
                          M         endif
  00000010                M pgcnt++
0103                      M lab_2_1:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000002                M labcnt2++
0103   11FD           00366             bcf MISC_STATE,3
                      00367           end_if
0104                      M lab_2_2:
                          M         banklabel
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 45


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  FFFFFFFF                M bankblock=-1
  00000001                M cdep--
                      00368         end_if 
0104                      M lab_1_10:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000000                M cdep--
0104   28A9           00369         goto    rhf4
                      00370 
                      00371 ; ******************************************************************************************************
                            ***********
                      00372 ; *** FLASH routines for reading, erasing, writing and flushing the FLASH memory
                      00373 ; readPFlash
                      00374 ;   This code block will read 1 word of program
                      00375 ;   memory at the memory address: HEXADR
                      00376 ;   data will be returned in the variables EEDATH, EEDATL
0105                  00377 readPFlash
0105   0023           00378         banksel EECON1
0106   2159           00379         call    load_eeadr      ; load HEXADR into EEADR
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0107   1315           00380 readPFlash_ld   BCF     EECON1,CFGS     ; Do not select Configuration Space
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0108   1795           00381         BSF     EECON1,EEPGD    ; Select Program Memory
                      00382         ;BCF    INTCON,GIE      ; Disable interrupts
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0109   1415           00383         BSF     EECON1,RD       ; Initiate read
010A   0000           00384         NOP             ; Executed (Figure 11-1)
010B   0000           00385         NOP             ; Ignored (Figure 11-1)
                      00386         ;BSF    INTCON,GIE      ; Restore interrupts
010C   0020           00387         banksel .0
010D   0008           00388         return
                      00389 
                      00390 ;erasePFlash
010E                  00391 erasePFlash
                      00392 ; This row erase routine
                      00393         ;BCF    INTCON,GIE ; Disable ints so required sequences will execute properly
010E   0023           00394         BANKSEL EECON1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
010F   1615           00395         BSF     EECON1,FREE ; Specify an erase operation
0110                  00396 PFlashHk
0110   2159           00397         call    load_eeadr      ; load HEXADR into EEADR
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0111   1795           00398         BSF     EECON1,EEPGD    ; Point to program memory
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0112   1315           00399         BCF     EECON1,CFGS     ; Not configuration space
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0113   1515           00400         BSF     EECON1,WREN     ; Enable writes
0114   3055           00401         MOVLW   55h     ; Start of required sequence to initiate erase
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0115   0096           00402         MOVWF   EECON2  ; Write 55h
0116   30AA           00403         MOVLW   0AAh    ;
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0117   0096           00404         MOVWF   EECON2  ; Write AAh
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 46


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0118   1495           00405         BSF     EECON1,WR       ; Set WR bit to begin erase
0119   0000           00406         NOP             ; Any instructions here are ignored as processor
                      00407                         ; halts to begin erase sequence
011A   0000           00408         NOP             ; Processor will stop here and wait for erase complete.
                      00409                         ; after erase processor continues with 3rd instruction
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
011B   1115           00410         BCF     EECON1,WREN     ; Disable writes
011C   0020           00411         BANKSEL .0
                      00412         ;BSF    INTCON,GIE      ; Enable interrupts
011D   0008           00413         return
                      00414 
                      00415 ; writePFlash
011E                  00416 writePFlash
                      00417 ; This write routine assumes the following:
011E   0023           00418         BANKSEL EECON1
011F   0873           00419         movf    RXDl,w  ; Load first data byte into lower
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0120   0093           00420         movwf   EEDATL
0121   0872           00421         movf    RXD,w   ; Load second data byte into upper
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0122   0094           00422         movwf   EEDATH
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0123   1695           00423         BSF     EECON1,LWLO     ; Only Load Write Latches
0124   0870           00424         movf    HEXADR,w        ; chech ik address is 1f
0125   391F           00425         andlw   0x1f
0126   3A1F           00426         xorlw   0x1f
0127   1903           00427         skpnz
0128   2935           00428         goto    wpf1
0129   1AFD           00429         btfsc   MISC_STATE, 5
012A   2935           00430         goto    wpf1
012B   167D           00431         bsf     MISC_STATE, 4   ; Only loading latches -> set flag for flush
                      00432         loadnb_f_f      HEXFADR, HEXADR ; store address for flush
012C   0870               M         movf    HEXADR, w
012D   00F4               M         movwf   HEXFADR
                      00433         loadnb_f_f      HEXFADR+1, HEXADR+1
012E   0871               M         movf    HEXADR+1, w
012F   00F5               M         movwf   HEXFADR+1
                      00434         loadnb_f_f      RXFD+1, RXD+1
0130   0873               M         movf    RXD+1, w
0131   00F7               M         movwf   RXFD+1
                      00435         loadnb_f_f      RXFD, RXD
0132   0872               M         movf    RXD,   w
0133   00F6               M         movwf   RXFD
0134   2910           00436         goto    PFlashHk
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0135   1295           00437 wpf1    BCF     EECON1,LWLO     ; No more loading latches - Actually start Flash program memory write
0136   127D           00438         bcf     MISC_STATE, 4
0137   12FD           00439         bcf     MISC_STATE, 5
0138   2910           00440         goto    PFlashHk
                      00441 
                      00442 ; checkFlush / checkFlushData
                      00443 ;   checkes wheter the atches are filled and need to be flushed because the hex file is nog going throug
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 47


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                            h ..1F address
                      00444 ;   checkFlush assumes it is clear from the HEXfile (e.g eof or segment change) flush is needed
                      00445 ;   checkFlushData is used if address is changed in the same HEXfile segment (caused by a new ORG in the
                             asm file)  
0139                  00446 checkFlushData
0139   0871           00447         movf    HEXADR+1,w      ; check whether HEXADR and HEXFADR are in the same ..1F segment
013A   0275           00448         subwf   HEXFADR+1,w
013B   1D03           00449         skpz    
013C   2942           00450         goto    checkFlush      ; upper byte already different -> flush maybe needed
                      00451 
013D   0874           00452         movf    HEXFADR,w
013E   0270           00453         subwf   HEXADR,w        ; assuming HEXADR is only increasing
013F   39E0           00454         andlw   0xE0    ; check only upper three bits
0140   1903           00455         skpnz   
0141   0008           00456         return  ; upper three bits of lower byte are equal -> no flush needed
                      00457 
0142                  00458 checkFlush
0142   187D           00459         btfsc   MISC_STATE,0            ; return if verify
0143   0008           00460         return 
0144   1E7D           00461         btfss   MISC_STATE,4            ; flush flag set?
0145   0008           00462         return
                      00463         loadnb_f_f      HEXADR+1, HEXFADR+1             ; retrieve flush address
0146   0875               M         movf    HEXFADR+1, w
0147   00F1               M         movwf   HEXADR+1
                      00464         loadnb_f_f      HEXADR, HEXFADR
0148   0874               M         movf    HEXFADR, w
0149   00F0               M         movwf   HEXADR
                      00465         loadnb_f_f      RXD+1, RXFD+1
014A   0877               M         movf    RXFD+1, w
014B   00F3               M         movwf   RXD+1
                      00466         loadnb_f_f      RXD, RXFD
014C   0876               M         movf    RXFD,  w
014D   00F2               M         movwf   RXD
014E   16FD           00467         bsf     MISC_STATE, 5           ; indicate flush
                      00468         ;goto   writeRXDtoflash
                      00469         ;return
                      00470 
                      00471 ; writeRXDtoflash
                      00472 ;  write value RXD to address HEXADR:2
014F                  00473 writeRXDtoflash
                      00474         if_f_lt_l       HEXADR+1,0x02   ; check whether not overwriting bootloader
  00000001                M cdep++
                          M         if cdep>mdep
                          M mdep++
                          M labcnt1        = 0
                          M         endif
  0000000B                M labcnt1++
                          M         gotoif_f_ge_l   HEXADR+1,0x02,lab_1_11
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
014F   3002               M          movlw  0x02
                          M          bankset        HEXADR+1
                          M         ;messg  "bank_option= "  #v(bank_option)
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 48


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         if      bank_option==0
                          M          if (HEXADR+1)>=_BANKSIZE
                          M           banksel       HEXADR+1
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((HEXADR+1)<0x70) || ((HEXADR+1)>=0x80)
                          M           banksel       HEXADR+1
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((HEXADR+1)/_BANKSIZE)!=bankblock && (((HEXADR+1)<0x70) || ((HEXADR+1)>=0x80))
                          M bankblock=((HEXADR+1)/_BANKSIZE)
                          M           banksel       HEXADR+1
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0150   0271               M          subwf  HEXADR+1,W
                          M          bankres        HEXADR+1
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (HEXADR+1)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
0151   1803               M          btfsc  STATUS,C
                          M          gotoc  lab_1_11
                          M         errorlevel      +306
0152   2954               M         goto    lab_1_11
                          M         else
                          M          movlw  0x02
                          M          bankset        HEXADR+1
                          M          subwf  HEXADR+1,W
                          M          bankres        HEXADR+1
                          M          pageset        lab_1_11
                          M          btfsc  STATUS,C
                          M          goto   lab_1_11
                          M          pageres
                          M         endif
  00000011                M pgcnt++
0153   0008           00475           return
                      00476         end_if
0154                      M lab_1_11:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000000                M cdep--
0154   0870           00477         movf    HEXADR,w
0155   391F           00478         andlw   0x1F    ; row 32 byte
0156   1903           00479         skpnz
0157   210E           00480         call    erasePFlash
0158   291E           00481         goto    writePFlash
                      00482         ;return
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 49


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00483         
                      00484 ; load_eeadr
                      00485 ;  assumes bank 3 selected
                      00486 ;  and loads HEXADR (70-7F) into EEADR
0159                  00487 load_eeadr
0159   0870           00488         movf    HEXADR,w        ; Load lower 8 bits of erase address boundary
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
015A   0091           00489         movwf   EEADRL
015B   0871           00490         movf    HEXADR+1,w      ; Load upper 6 bits of erase address boundary
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
015C   0092           00491         movwf   EEADRH
015D   0008           00492         return
                      00493 
015E                  00494 uart_write_TX_OUT
015E   087A           00495         movf    TX_OUT, w
015F                  00496 uart_write_w    
015F   1E11           00497         btfss   PIR1, TXIF
0160   295F           00498         goto    $-1
0161   0023           00499         banksel TXREG
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0162   009A           00500         movwf   TXREG
0163   0020           00501         banksel .0
0164   0008           00502         return
                      00503 
                      00504 ; ******************************************************************************************************
                            ***********
                      00505 ; *** READRX routines for reading from serial input
                      00506 ; readRXwait - wait for RX and put in RXD
                      00507         ifndef  FAKEINPUT
0165                  00508 readRXwait
                      00509 ; Read UART
0165                  00510 rrxw2   ;
0165   0023           00511         banksel RCSTA
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0166   1C9D           00512         btfss   RCSTA, OERR     ; Overrun?
0167   296A           00513         goto    rrxw1
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0168   121D           00514         bcf     RCSTA, CREN     ; clear overrun
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0169   161D           00515         bsf     RCSTA, CREN
                      00516         
016A                  00517 rrxw1   ;if_f_b_s       PIR1, RCIF      ; recieved?
016A   0020           00518         banksel .0
016B   1E91           00519         btfss   PIR1, RCIF      ; recieved?
016C   2965           00520         goto    rrxw2
                      00521 
                      00522         ; character recieved
                      00523          ; if_f_b_s     RCSTA,FERR      ; Framing error
016D   0023           00524         banksel RCSTA
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
016E   1D1D           00525         btfss   RCSTA,FERR      ; Framing error
016F   2973           00526         goto    rrxw3
                      00527         loadnb_f_f      RXD, RCREG      ; copy recieved byte
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 50


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0170   0819               M         movf    RCREG, w
0171   00F2               M         movwf   RXD
                      00528         ;banksel        .0
0172   2965           00529         goto    rrxw2
                      00530 
                      00531 rrxw3   loadnb_f_f      RXD, RCREG      ; copy recieved byte
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0173   0819               M         movf    RCREG, w
0174   00F2               M         movwf   RXD
                      00532         if_f_ge_l       RXD,.97 ; lower case -> upper case
  00000001                M cdep++
                          M         if cdep>mdep
                          M mdep++
                          M labcnt1        = 0
                          M         endif
  0000000C                M labcnt1++
                          M         gotoif_f_lt_l   RXD,.97,lab_1_12
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
0175   3061               M          movlw  .97
                          M          bankset        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0176   0272               M          subwf  RXD,W
                          M          bankres        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
0177   1C03               M          btfss  STATUS,C
                          M          gotoc  lab_1_12
                          M         errorlevel      +306
0178   297F               M         goto    lab_1_12
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 51


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         else
                          M          movlw  .97
                          M          bankset        RXD
                          M          subwf  RXD,W
                          M          bankres        RXD
                          M          pageset        lab_1_12
                          M          btfss  STATUS,C
                          M          goto   lab_1_12
                          M          pageres
                          M         endif
  00000012                M pgcnt++
                      00533           if_f_lt_l     RXD,.123
  00000002                M cdep++
                          M         if cdep>mdep
                          M mdep++
                          M labcnt2        = 0
                          M         endif
  00000003                M labcnt2++
                          M         gotoif_f_ge_l   RXD,.123,lab_2_3
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
0179   307B               M          movlw  .123
                          M          bankset        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
017A   0272               M          subwf  RXD,W
                          M          bankres        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
017B   1803               M          btfsc  STATUS,C
                          M          gotoc  lab_2_3
                          M         errorlevel      +306
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 52


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

017C   297F               M         goto    lab_2_3
                          M         else
                          M          movlw  .123
                          M          bankset        RXD
                          M          subwf  RXD,W
                          M          bankres        RXD
                          M          pageset        lab_2_3
                          M          btfsc  STATUS,C
                          M          goto   lab_2_3
                          M          pageres
                          M         endif
  00000013                M pgcnt++
017D   30E0           00534             movlw       .224
017E   07F2           00535             addwf       RXD,f
                      00536           end_if
017F                      M lab_2_3:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000001                M cdep--
                      00537         end_if
017F                      M lab_1_12:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000000                M cdep--
017F   0020           00538         banksel .0
                      00539 
                      00540         ;if_f_eq_l      RXD,'Q' ; to Menu if Q
0180   0872           00541         movf    RXD,w   ; to Menu if Q
0181   3C51           00542         sublw   'Q'
0182   1D03           00543         skpz
0183   0008           00544         return
                      00545         load_f_l        STKPTR,0x00     ; clear stack
0184   3000               M         movlw   0x00
                          M         load_f_w        STKPTR
                          M         bankset STKPTR
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (STKPTR)>=_BANKSIZE
0185   003F               M           banksel       STKPTR
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((STKPTR)<0x70) || ((STKPTR)>=0x80)
                          M           banksel       STKPTR
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((STKPTR)/_BANKSIZE)!=bankblock && (((STKPTR)<0x70) || ((STKPTR)>=0x80))
                          M bankblock=((STKPTR)/_BANKSIZE)
                          M           banksel       STKPTR
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 53


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0186   00ED               M         movwf   STKPTR
                          M         bankres STKPTR
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (STKPTR)>=_BANKSIZE
0187   0020               M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
0188   282A           00546         goto    mainloop
                      00547         ;end_if
                      00548         ;bcf    PORTB,1 ; Orange LED off
                      00549         ;return
                      00550         endif   
                      00551 
                      00552 ; readRXwait - wait for RX and put in RXD - DEBUG MODE
                      00553         ifdef   FAKEINPUT
                      00554 readRXwait
                      00555         call    get_fake_char
                      00556         movwf   RXD
                      00557         movlw   .1
                      00558         addwf   fakereadadr,f
                      00559         movlw   .0
                      00560         addwfc  fakereadadr+1,f
                      00561         return
                      00562 get_fake_char   load_f_f        PCLATH, fakereadadr+1
                      00563         load_f_f        PCL, fakereadadr
                      00564         endif
                      00565 
                      00566 ; read two hex characters and convert to byte
0189                  00567 readhexbyteRXwait
0189   2165           00568         call    readRXwait      ; first caracter
018A   21B3           00569         call    hextobin
018B   0E72           00570         swapf   RXD,W
018C   00A6           00571         movwf   RXDtmp
018D   2165           00572         call    readRXwait      ; second character
018E   21B3           00573         call    hextobin
018F   0826           00574         movf    RXDtmp,W
0190   04F2           00575         iorwf   RXD,f
0191   0008           00576         return
                      00577 
                      00578 ; ******************************************************************************************************
                            ***********
                      00579 ; *** WRITE TEXT routines for writing to serial output
                      00580 
                      00581 ; write_text
                      00582 ;   outputs text, starting from TEXT_POS, until zero-character is detected
0192                  00583 write_text:     ;return ; *****************************************************************
                      00584         ;repeat
                      00585         ;until_f_b_s    BUFST, 7
0192   0023           00586         banksel EECON1
                      00587         loadnb_f_f      EEADRH, TEXT_POS+1
0193   0879               M         movf    TEXT_POS+1, w
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 54


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0194   0092               M         movwf   EEADRH
                      00588         loadnb_f_f      EEADRL, TEXT_POS
0195   0878               M         movf    TEXT_POS, w
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
0196   0091               M         movwf   EEADRL
0197   2107           00589         call    readPFlash_ld
                      00590         load_f_f        TX_OUT, EEDATH  ; first character
                          M         load_w_f        EEDATH
                          M     bankset     EEDATH
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (EEDATH)>=_BANKSIZE
0198   0023               M           banksel       EEDATH
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((EEDATH)<0x70) || ((EEDATH)>=0x80)
                          M           banksel       EEDATH
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((EEDATH)/_BANKSIZE)!=bankblock && (((EEDATH)<0x70) || ((EEDATH)>=0x80))
                          M bankblock=((EEDATH)/_BANKSIZE)
                          M           banksel       EEDATH
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
0199   0814               M         movf    EEDATH,W
                          M         bankres EEDATH
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (EEDATH)>=_BANKSIZE
019A   0020               M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         load_f_w        TX_OUT
                          M         bankset TX_OUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TX_OUT)>=_BANKSIZE
                          M           banksel       TX_OUT
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((TX_OUT)<0x70) || ((TX_OUT)>=0x80)
                          M           banksel       TX_OUT
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((TX_OUT)/_BANKSIZE)!=bankblock && (((TX_OUT)<0x70) || ((TX_OUT)>=0x80))
                          M bankblock=((TX_OUT)/_BANKSIZE)
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 55


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M           banksel       TX_OUT
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
019B   00FA               M         movwf   TX_OUT
                          M         bankres TX_OUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TX_OUT)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
019C   0023           00591         banksel EECON1
019D   137A           00592         bcf     TX_OUT,6
Message[302]: Register in operand not in bank 0.  Ensure that bank bits are correct.
019E   1B93           00593         btfsc   EEDATL,7
019F   177A           00594         bsf     TX_OUT,6
01A0   0020           00595         banksel .0
01A1   087A           00596         movf    TX_OUT, w
01A2   1903           00597         skpnz
01A3   0008           00598         return
01A4   215E           00599         call    uart_write_TX_OUT       ; write out
                      00600         load_f_f        TX_OUT, EEDATL  ; second character
                          M         load_w_f        EEDATL
                          M     bankset     EEDATL
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (EEDATL)>=_BANKSIZE
01A5   0023               M           banksel       EEDATL
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((EEDATL)<0x70) || ((EEDATL)>=0x80)
                          M           banksel       EEDATL
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((EEDATL)/_BANKSIZE)!=bankblock && (((EEDATL)<0x70) || ((EEDATL)>=0x80))
                          M bankblock=((EEDATL)/_BANKSIZE)
                          M           banksel       EEDATL
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
01A6   0813               M         movf    EEDATL,W
                          M         bankres EEDATL
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (EEDATL)>=_BANKSIZE
01A7   0020               M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 56


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         load_f_w        TX_OUT
                          M         bankset TX_OUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TX_OUT)>=_BANKSIZE
                          M           banksel       TX_OUT
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((TX_OUT)<0x70) || ((TX_OUT)>=0x80)
                          M           banksel       TX_OUT
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((TX_OUT)/_BANKSIZE)!=bankblock && (((TX_OUT)<0x70) || ((TX_OUT)>=0x80))
                          M bankblock=((TX_OUT)/_BANKSIZE)
                          M           banksel       TX_OUT
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
01A8   00FA               M         movwf   TX_OUT
                          M         bankres TX_OUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TX_OUT)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
01A9   13FA           00601         bcf     TX_OUT,7
01AA   0020           00602         banksel .0
01AB   087A           00603         movf    TX_OUT, w
01AC   1903           00604         skpnz
01AD   0008           00605         return
01AE   215E           00606         call    uart_write_TX_OUT       ; write out
01AF   0AF8           00607         incf    TEXT_POS, f     ; increment TEXT_POS
01B0   1903           00608         btfsc   STATUS,Z
01B1   0AF9           00609         incf    TEXT_POS+1, f   
01B2   2992           00610         goto    write_text      
                      00611         
                      00612 
                      00613 ; hextobin
                      00614 ;  convert single HEX character in RXD to binary value in RXD
                      00615 hextobin:       if_f_b_s        RXD, 6  ; 0x3? or 0x4?
  00000001                M cdep++
                          M         if cdep>mdep
                          M mdep++
                          M labcnt1        = 0
                          M         endif
  0000000D                M labcnt1++
                          M         gotoif_f_b_c    RXD,6,lab_1_13
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 57


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M          bankset        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((RXD)<0x70) || ((RXD)>=0x80)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((RXD)/_BANKSIZE)!=bankblock && (((RXD)<0x70) || ((RXD)>=0x80))
                          M bankblock=((RXD)/_BANKSIZE)
                          M           banksel       RXD
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
01B3   1F72               M          btfss  RXD,6
                          M          gotoc  lab_1_13
                          M         errorlevel      +306
01B4   29B7               M         goto    lab_1_13
                          M          bankres        RXD
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (RXD)>=_BANKSIZE
                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
                          M         else
                          M jcnt++
                          M          bankset        RXD
                          M          pageset        j_0_0
                          M          btfsc  RXD,6
                          M          goto   j_0_0
                          M          bankres        RXD
                          M          pageset        lab_1_13
                          M          goto   lab_1_13
                          M j_0_0:
                          M         banklabel
                          M          bankres        RXD
                          M          pageres
                          M         endif
  00000014                M pgcnt++
01B5   3009           00616           movlw .9      ; A..F: + 9
01B6   07F2           00617           addwf RXD,f
                      00618         end_if
01B7                      M lab_1_13:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000000                M cdep--
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 58


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01B7   300F           00619         movlw   0x0F
01B8   05F2           00620         andwf   RXD,f
01B9   0008           00621         return
                      00622 
                      00623 
                      00624 ; write_hex             
                      00625 ;   writes HEXOUT as two chracter HEX value to TX_OUT
01BA                  00626 write_hex:      
01BA   0829           00627 wh1:    movf    HEXOUT, w
01BB   0E89           00628         swapf   WREG, f
01BC   21C0           00629         call    write_hex_n     ; write first char
01BD   0829           00630         movf    HEXOUT, w
01BE   21C0           00631         call    write_hex_n     ; write second char
01BF   0008           00632         return
01C0                  00633 write_hex_n:
                      00634         ;movlw  0x0F
01C0   390F           00635         andlw   0x0F
01C1   00FA           00636         movwf   TX_OUT
                      00637         if_f_ge_l       TX_OUT, .10
  00000001                M cdep++
                          M         if cdep>mdep
                          M mdep++
                          M labcnt1        = 0
                          M         endif
  0000000E                M labcnt1++
                          M         gotoif_f_lt_l   TX_OUT,.10,lab_1_14
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
01C2   300A               M          movlw  .10
                          M          bankset        TX_OUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TX_OUT)>=_BANKSIZE
                          M           banksel       TX_OUT
                          M          endif
                          M         endif
                          M         if      bank_option==1
                          M          if ((TX_OUT)<0x70) || ((TX_OUT)>=0x80)
                          M           banksel       TX_OUT
                          M          endif
                          M         endif
                          M         if      bank_option==2
                          M          if ((TX_OUT)/_BANKSIZE)!=bankblock && (((TX_OUT)<0x70) || ((TX_OUT)>=0x80))
                          M bankblock=((TX_OUT)/_BANKSIZE)
                          M           banksel       TX_OUT
                          M          endif
                          M         endif
                          M         errorlevel      -302    ; supress bank bit warning
01C3   027A               M          subwf  TX_OUT,W
                          M          bankres        TX_OUT
                          M         ;messg  "bank_option= "  #v(bank_option)
                          M         if      bank_option==0
                          M          if (TX_OUT)>=_BANKSIZE
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 59


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M           banksel       0
                          M          endif
                          M         endif
                          M         errorlevel      +302
01C4   1C03               M          btfss  STATUS,C
                          M          gotoc  lab_1_14
                          M         errorlevel      +306
01C5   29C9               M         goto    lab_1_14
                          M         else
                          M          movlw  .10
                          M          bankset        TX_OUT
                          M          subwf  TX_OUT,W
                          M          bankres        TX_OUT
                          M          pageset        lab_1_14
                          M          btfss  STATUS,C
                          M          goto   lab_1_14
                          M          pageres
                          M         endif
  00000015                M pgcnt++
01C6   3037           00638          movlw  0x37
01C7   07FA           00639          addwf  TX_OUT, f
                      00640         else_
                          M         gotop   lab_1_15
                          M         ;if     (page_option==0) || ((page_option==2) && (PAGESELSW_#v(pgcnt) == 0))
                          M         if      (page_option==0)
                          M          gotoc  lab_1_15
                          M         errorlevel      +306
01C8   29CB               M         goto    lab_1_15
                          M         else
                          M          pageset        lab_1_15
                          M          goto   lab_1_15
                          M          pageres
                          M         endif
  00000016                M pgcnt++
01C9                      M lab_1_14:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  0000000F                M labcnt1++
01C9   3030           00641          movlw  0x30
01CA   04FA           00642          iorwf  TX_OUT, f
                      00643         end_if
01CB                      M lab_1_15:
                          M         banklabel
  FFFFFFFF                M bankblock=-1
  00000000                M cdep--
01CB   215E           00644         call    uart_write_TX_OUT       ; write out
01CC   0008           00645         return
                      00646 
01CD                  00647 write_lf:
                      00648         ;write_char     .13
                      00649         uart_write_l    .10
01CD   300A               M         movlw   .10
01CE   215F               M         call    uart_write_w
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 60


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01CF   0008           00650         return
                      00651 
01D0                  00652 write_space:
                      00653         uart_write_l    .32
01D0   3020               M         movlw   .32
01D1   215F               M         call    uart_write_w
01D2   0008           00654         return
                      00655 
                      00656 ; ******************************************************************************************************
                            ***********
                      00657 ; *** TEXT definitions
                      00658 
                      00659 ;text_menu:     dt      .10,"Menu",.10," [W]rite",.10," [V]erify",.10," [R]ead",.10," [G]o",.10,0
                      00660 ;text_hexfile:  dt      "Send HEXfile ([Q] to quit)",.10,0
                      00661 ;text_error:    dt      " Verify errors",.10,0
                      00662 ;text_OK:       dt      "OK",.10,0
                      00663 ;text_bye:      dt      "Bye!",.10,0
                      00664 
                      00665 text_menu       OctC2W  .10, "M", "e", "n", "u", .10, "[", "W"
                          M         DoubleC2W       .10,   "M"
01D3   0A4D               M         dw      (( ((.10   & 0x3F) << 8) | ((.10   & 0x40) << 1) | ("M"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "e",   "n"
01D4   25EE               M         dw      (( (("e"   & 0x3F) << 8) | (("e"   & 0x40) << 1) | ("n"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "u",   .10
01D5   358A               M         dw      (( (("u"   & 0x3F) << 8) | (("u"   & 0x40) << 1) | (.10   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "[",   "W"
01D6   1BD7               M         dw      (( (("["   & 0x3F) << 8) | (("["   & 0x40) << 1) | ("W"   & 0x7F) ) & 0x3FFF)
                      00666         OctC2W  "]", "r", "i", "t", "e", .10, "[", "V"
                          M         DoubleC2W       "]",   "r"
01D7   1DF2               M         dw      (( (("]"   & 0x3F) << 8) | (("]"   & 0x40) << 1) | ("r"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "i",   "t"
01D8   29F4               M         dw      (( (("i"   & 0x3F) << 8) | (("i"   & 0x40) << 1) | ("t"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "e",   .10
01D9   258A               M         dw      (( (("e"   & 0x3F) << 8) | (("e"   & 0x40) << 1) | (.10   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "[",   "V"
01DA   1BD6               M         dw      (( (("["   & 0x3F) << 8) | (("["   & 0x40) << 1) | ("V"   & 0x7F) ) & 0x3FFF)
                      00667         OctC2W  "]", "e", "r", "i", "f", "y", .10, "["
                          M         DoubleC2W       "]",   "e"
01DB   1DE5               M         dw      (( (("]"   & 0x3F) << 8) | (("]"   & 0x40) << 1) | ("e"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "r",   "i"
01DC   32E9               M         dw      (( (("r"   & 0x3F) << 8) | (("r"   & 0x40) << 1) | ("i"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "f",   "y"
01DD   26F9               M         dw      (( (("f"   & 0x3F) << 8) | (("f"   & 0x40) << 1) | ("y"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       .10,   "["
01DE   0A5B               M         dw      (( ((.10   & 0x3F) << 8) | ((.10   & 0x40) << 1) | ("["   & 0x7F) ) & 0x3FFF)
                      00668         OctC2W  "R", "]", "e", "a", "d", .10, "[", "G"
                          M         DoubleC2W       "R",   "]"
01DF   12DD               M         dw      (( (("R"   & 0x3F) << 8) | (("R"   & 0x40) << 1) | ("]"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "e",   "a"
01E0   25E1               M         dw      (( (("e"   & 0x3F) << 8) | (("e"   & 0x40) << 1) | ("a"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "d",   .10
01E1   248A               M         dw      (( (("d"   & 0x3F) << 8) | (("d"   & 0x40) << 1) | (.10   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "[",   "G"
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 61


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01E2   1BC7               M         dw      (( (("["   & 0x3F) << 8) | (("["   & 0x40) << 1) | ("G"   & 0x7F) ) & 0x3FFF)
                      00669         QuadC2W "]", "o", .10, 0x0
                          M         DoubleC2W       "]",   "o"
01E3   1DEF               M         dw      (( (("]"   & 0x3F) << 8) | (("]"   & 0x40) << 1) | ("o"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       .10,   0x0
01E4   0A00               M         dw      (( ((.10   & 0x3F) << 8) | ((.10   & 0x40) << 1) | (0x0   & 0x7F) ) & 0x3FFF)
                      00670 text_hexfile    OctC2W  "S", "e", "n", "d", " ", "H", "E", "X"
                          M         DoubleC2W       "S",   "e"
01E5   13E5               M         dw      (( (("S"   & 0x3F) << 8) | (("S"   & 0x40) << 1) | ("e"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "n",   "d"
01E6   2EE4               M         dw      (( (("n"   & 0x3F) << 8) | (("n"   & 0x40) << 1) | ("d"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       " ",   "H"
01E7   2048               M         dw      (( ((" "   & 0x3F) << 8) | ((" "   & 0x40) << 1) | ("H"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "E",   "X"
01E8   05D8               M         dw      (( (("E"   & 0x3F) << 8) | (("E"   & 0x40) << 1) | ("X"   & 0x7F) ) & 0x3FFF)
                      00671         OctC2W  "f", "i", "l", "e", " ", "[", "Q", "]"
                          M         DoubleC2W       "f",   "i"
01E9   26E9               M         dw      (( (("f"   & 0x3F) << 8) | (("f"   & 0x40) << 1) | ("i"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "l",   "e"
01EA   2CE5               M         dw      (( (("l"   & 0x3F) << 8) | (("l"   & 0x40) << 1) | ("e"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       " ",   "["
01EB   205B               M         dw      (( ((" "   & 0x3F) << 8) | ((" "   & 0x40) << 1) | ("["   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "Q",   "]"
01EC   11DD               M         dw      (( (("Q"   & 0x3F) << 8) | (("Q"   & 0x40) << 1) | ("]"   & 0x7F) ) & 0x3FFF)
                      00672         OctC2W  " ", "t", "o", " ", "q", "u", "i", "t"
                          M         DoubleC2W       " ",   "t"
01ED   2074               M         dw      (( ((" "   & 0x3F) << 8) | ((" "   & 0x40) << 1) | ("t"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "o",   " "
01EE   2FA0               M         dw      (( (("o"   & 0x3F) << 8) | (("o"   & 0x40) << 1) | (" "   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "q",   "u"
01EF   31F5               M         dw      (( (("q"   & 0x3F) << 8) | (("q"   & 0x40) << 1) | ("u"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "i",   "t"
01F0   29F4               M         dw      (( (("i"   & 0x3F) << 8) | (("i"   & 0x40) << 1) | ("t"   & 0x7F) ) & 0x3FFF)
                      00673         DoubleC2W       .10, 0x0
01F1   0A00               M         dw      (( ((.10   & 0x3F) << 8) | ((.10   & 0x40) << 1) | (0x0   & 0x7F) ) & 0x3FFF)
                      00674 text_errors     OctC2W  " ", "v", "e", "r", "i", "f", "y", " "
                          M         DoubleC2W       " ",   "v"
01F2   2076               M         dw      (( ((" "   & 0x3F) << 8) | ((" "   & 0x40) << 1) | ("v"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "e",   "r"
01F3   25F2               M         dw      (( (("e"   & 0x3F) << 8) | (("e"   & 0x40) << 1) | ("r"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "i",   "f"
01F4   29E6               M         dw      (( (("i"   & 0x3F) << 8) | (("i"   & 0x40) << 1) | ("f"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "y",   " "
01F5   39A0               M         dw      (( (("y"   & 0x3F) << 8) | (("y"   & 0x40) << 1) | (" "   & 0x7F) ) & 0x3FFF)
                      00675         OctC2W  "e", "r", "r", "o", "r", "s", .10, 0x0
                          M         DoubleC2W       "e",   "r"
01F6   25F2               M         dw      (( (("e"   & 0x3F) << 8) | (("e"   & 0x40) << 1) | ("r"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "r",   "o"
01F7   32EF               M         dw      (( (("r"   & 0x3F) << 8) | (("r"   & 0x40) << 1) | ("o"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "r",   "s"
01F8   32F3               M         dw      (( (("r"   & 0x3F) << 8) | (("r"   & 0x40) << 1) | ("s"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       .10,   0x0
01F9   0A00               M         dw      (( ((.10   & 0x3F) << 8) | ((.10   & 0x40) << 1) | (0x0   & 0x7F) ) & 0x3FFF)
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 62


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00676 text_OK QuadC2W "O", "K", .10, 0x0
                          M         DoubleC2W       "O",   "K"
01FA   0FCB               M         dw      (( (("O"   & 0x3F) << 8) | (("O"   & 0x40) << 1) | ("K"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       .10,   0x0
01FB   0A00               M         dw      (( ((.10   & 0x3F) << 8) | ((.10   & 0x40) << 1) | (0x0   & 0x7F) ) & 0x3FFF)
                      00677 text_bye        QuadC2W "B", "y", "e", "!"
                          M         DoubleC2W       "B",   "y"
01FC   02F9               M         dw      (( (("B"   & 0x3F) << 8) | (("B"   & 0x40) << 1) | ("y"   & 0x7F) ) & 0x3FFF)
                          M         DoubleC2W       "e",   "!"
01FD   25A1               M         dw      (( (("e"   & 0x3F) << 8) | (("e"   & 0x40) << 1) | ("!"   & 0x7F) ) & 0x3FFF)
                      00678         DoubleC2W       .10, 0x0
01FE   0A00               M         dw      (( ((.10   & 0x3F) << 8) | ((.10   & 0x40) << 1) | (0x0   & 0x7F) ) & 0x3FFF)
                      00679 
                      00680 
                      00681 ; ******************************************************************************************************
                            ***********
                      00682 ; *** Input data for debuging (define FAKEINPUT)
                      00683         ifdef   FAKEINPUT
                      00684         org 0x0300
                      00685 fakedata        dt      "W"
                      00686         dt      ":020000040000FA"
                      00687         dt      ":10040000052A00000000000009008B13F8302100CD"
                      00688         dt      ":1004100099002000003023008D00200000308D0066"
                      00689         dt      ":10042000FC3021008D002000043024008D002000CD"
                      00690         dt      ":10043000BF3021008E002000003023009C002000EF"
                      00691         dt      ":10044000193023009B00200023001E1120002300F0"
                      00692         dt      ":100450009F11200023009E16200023001D1620005F"
                      00693         dt      ":1004600023001E12200023009D1720000D108D1464"
                      00694         dt      ":100470006A220D148D106A220D108D146A220D103F"
                      00695         dt      ":100480008D106A227410911E4B2A741423001908CF"
                      00696         dt      ":100490002000F200622A23001D19502A2000562A4B"
                      00697         dt      ":1004A0002000230019082000F200622A23009D1872"
                      00698         dt      ":1004B0005B2A2000622A200023001D122000230056"
                      00699         dt      ":1004C0001D162000741C692A42307202031D692A1D"
                      00700         dt      ":1004D0000100362A0030A0000030A1000030A20048"
                      00701         dt      ":1004E0000030A30000302302031C782A031DC92A10"
                      00702         dt      ":1004F00000302302031C962A00302202031C822AA9"
                      00703         dt      ":10050000031DC92A00302202031C962ACE30210284"
                      00704         dt      ":10051000031C8C2A031DC92ACE302102031C962AF3"
                      00705         dt      ":100520009D302002031C962A031DC92AC72A0030C9"
                      00706         dt      ":100530002302031C9D2A031DC92A00302302031C29"
                      00707         dt      ":10054000B92A00302202031CA72A031DC92A003041"
                      00708         dt      ":100550002202031CB92ACE302102031CB12A031D3A"
                      00709         dt      ":10056000C92ACE302102031CB92A9D30200203186B"
                      00710         dt      ":10057000C92A0130A007031CBF2A0130A107031CB0"
                      00711         dt      ":10058000C32A0130A207031CC72A0130A3070000B9"
                      00712         dt      ":04059000972A08009E"
                      00713         dt      ":0240200000009E"
                      00714         dt      ":027F040000007B"
                      00715         dt      ":020000040001F9"
                      00716         dt      ":02000E00A42F1D"
                      00717         dt      ":02001000FF39B6"
                      00718         dt      ":00000001FF"
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 63


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00719         dt      .10, .10, .10, "G"
                      00720         endif
                      00721 
                      00722 
                      00723         END
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 64


SYMBOL TABLE
  LABEL                             VALUE 

ABDEN                             00000000
ABDOVF                            00000007
ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ACKTIM                            00000007
ADCON0                            0000009D
ADCON1                            0000009E
ADCS0                             00000004
ADCS1                             00000005
ADCS2                             00000006
ADDEN                             00000003
ADFM                              00000007
ADFVR0                            00000000
ADFVR1                            00000001
ADGO                              00000001
ADIE                              00000006
ADIF                              00000006
ADNREF                            00000002
ADON                              00000000
ADPREF0                           00000000
ADPREF1                           00000001
ADRES                             0000009B
ADRESH                            0000009C
ADRESL                            0000009B
AHEN                              00000001
ANSA0                             00000000
ANSA1                             00000001
ANSA2                             00000002
ANSA3                             00000003
ANSA4                             00000004
ANSA5                             00000005
ANSB0                             00000000
ANSB1                             00000001
ANSB2                             00000002
ANSB3                             00000003
ANSB4                             00000004
ANSB5                             00000005
ANSELA                            0000018C
ANSELB                            0000018D
APFCON                            0000011D
BAUDCON                           0000019F
BCLIE                             00000003
BCLIF                             00000003
BF                                00000000
BIASMD                            00000006
BOEN                              00000004
BORCON                            00000116
BORRDY                            00000000
BRG16                             00000003
BRGH                              00000002
BSR                               00000008
BSR0                              00000000
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 65


SYMBOL TABLE
  LABEL                             VALUE 

BSR1                              00000001
BSR2                              00000002
BSR3                              00000003
BSR4                              00000004
BSR_SHAD                          00000FE6
C                                 00000000
C1HYS                             00000001
C1IE                              00000005
C1IF                              00000005
C1INTN                            00000006
C1INTP                            00000007
C1NCH0                            00000000
C1NCH1                            00000001
C1OE                              00000005
C1ON                              00000007
C1OUT                             00000006
C1PCH0                            00000004
C1PCH1                            00000005
C1POL                             00000004
C1SP                              00000002
C1SYNC                            00000000
C1TSEL0                           00000000
C1TSEL1                           00000001
C2HYS                             00000001
C2IE                              00000006
C2IF                              00000006
C2INTN                            00000006
C2INTP                            00000007
C2NCH0                            00000000
C2NCH1                            00000001
C2OE                              00000005
C2ON                              00000007
C2OUT                             00000006
C2OUTSEL                          00000002
C2PCH0                            00000004
C2PCH1                            00000005
C2POL                             00000004
C2SP                              00000002
C2SYNC                            00000000
C2TSEL0                           00000002
C2TSEL1                           00000003
C3TSEL0                           00000004
C3TSEL1                           00000005
C4TSEL0                           00000006
C4TSEL1                           00000007
C5TSEL0                           00000000
C5TSEL1                           00000001
CCP1AS                            00000295
CCP1AS0                           00000004
CCP1AS1                           00000005
CCP1AS2                           00000006
CCP1ASE                           00000007
CCP1CON                           00000293
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 66


SYMBOL TABLE
  LABEL                             VALUE 

CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP2AS                            0000029C
CCP2AS0                           00000004
CCP2AS1                           00000005
CCP2AS2                           00000006
CCP2ASE                           00000007
CCP2CON                           0000029A
CCP2IE                            00000000
CCP2IF                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2SEL                           00000000
CCP3AS                            00000315
CCP3AS0                           00000004
CCP3AS1                           00000005
CCP3AS2                           00000006
CCP3ASE                           00000007
CCP3CON                           00000313
CCP3IE                            00000004
CCP3IF                            00000004
CCP3M0                            00000000
CCP3M1                            00000001
CCP3M2                            00000002
CCP3M3                            00000003
CCP3SEL                           00000006
CCP4CON                           0000031A
CCP4IE                            00000005
CCP4IF                            00000005
CCP4M0                            00000000
CCP4M1                            00000001
CCP4M2                            00000002
CCP4M3                            00000003
CCP5CON                           0000031E
CCP5IE                            00000006
CCP5IF                            00000006
CCP5M0                            00000000
CCP5M1                            00000001
CCP5M2                            00000002
CCP5M3                            00000003
CCPR1                             00000291
CCPR1H                            00000292
CCPR1L                            00000291
CCPR2                             00000298
CCPR2H                            00000299
CCPR2L                            00000298
CCPR3                             00000311
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 67


SYMBOL TABLE
  LABEL                             VALUE 

CCPR3H                            00000312
CCPR3L                            00000311
CCPR4                             00000318
CCPR4H                            00000319
CCPR4L                            00000318
CCPR5                             0000031C
CCPR5H                            0000031D
CCPR5L                            0000031C
CCPTMRS0                          0000029E
CCPTMRS1                          0000029F
CDAFVR0                           00000002
CDAFVR1                           00000003
CFGS                              00000006
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CHS3                              00000005
CHS4                              00000006
CKE                               00000006
CKP                               00000004
CM1CON0                           00000111
CM1CON1                           00000112
CM2CON0                           00000113
CM2CON1                           00000114
CMOUT                             00000115
CPSCH0                            00000000
CPSCH1                            00000001
CPSCH2                            00000002
CPSCON0                           0000001E
CPSCON1                           0000001F
CPSON                             00000007
CPSOUT                            00000001
CPSRM                             00000006
CPSRNG0                           00000002
CPSRNG1                           00000003
CREN                              00000004
CS0                               00000002
CS1                               00000003
CSRC                              00000007
C_SHAD                            00000000
DACCON0                           00000118
DACCON1                           00000119
DACEN                             00000007
DACLPS                            00000006
DACNSS                            00000000
DACOE                             00000005
DACPSS0                           00000002
DACPSS1                           00000003
DACR0                             00000000
DACR1                             00000001
DACR2                             00000002
DACR3                             00000003
DACR4                             00000004
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 68


SYMBOL TABLE
  LABEL                             VALUE 

DC                                00000001
DC1B0                             00000004
DC1B1                             00000005
DC2B0                             00000004
DC2B1                             00000005
DC3B0                             00000004
DC3B1                             00000005
DC4B0                             00000004
DC4B1                             00000005
DC5B0                             00000004
DC5B1                             00000005
DC_SHAD                           00000001
DHEN                              00000000
D_NOT_A                           00000005
DoubleC2W                         
ECCP1AS                           00000295
ECCP2AS                           0000029C
ECCP3AS                           00000315
EEADR                             00000191
EEADRH                            00000192
EEADRL                            00000191
EECON1                            00000195
EECON2                            00000196
EEDAT                             00000193
EEDATH                            00000194
EEDATL                            00000193
EEIE                              00000004
EEIF                              00000004
EEPGD                             00000007
ERRCNT                            0000007B
F                                 00000001
FERR                              00000002
FREE                              00000004
FSR0                              00000004
FSR0H                             00000005
FSR0H_SHAD                        00000FE9
FSR0L                             00000004
FSR0L_SHAD                        00000FE8
FSR1                              00000006
FSR1H                             00000007
FSR1H_SHAD                        00000FEB
FSR1L                             00000006
FSR1L_SHAD                        00000FEA
FVRCON                            00000117
FVREN                             00000007
FVRRDY                            00000006
GCEN                              00000007
GIE                               00000007
GO                                00000001
GO_NOT_DONE                       00000001
HEXADR                            00000070
HEXFADR                           00000074
HEXOUT                            00000029
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 69


SYMBOL TABLE
  LABEL                             VALUE 

HEXOUTCNT                         0000002A
HEXTADR                           00000027
HFIOFL                            00000003
HFIOFR                            00000004
HFIOFS                            00000000
INDF0                             00000000
INDF1                             00000001
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IOCBF                             00000396
IOCBF0                            00000000
IOCBF1                            00000001
IOCBF2                            00000002
IOCBF3                            00000003
IOCBF4                            00000004
IOCBF5                            00000005
IOCBF6                            00000006
IOCBF7                            00000007
IOCBN                             00000395
IOCBN0                            00000000
IOCBN1                            00000001
IOCBN2                            00000002
IOCBN3                            00000003
IOCBN4                            00000004
IOCBN5                            00000005
IOCBN6                            00000006
IOCBN7                            00000007
IOCBP                             00000394
IOCBP0                            00000000
IOCBP1                            00000001
IOCBP2                            00000002
IOCBP3                            00000003
IOCBP4                            00000004
IOCBP5                            00000005
IOCBP6                            00000006
IOCBP7                            00000007
IOCIE                             00000003
IOCIF                             00000000
IRCF0                             00000003
IRCF1                             00000004
IRCF2                             00000005
IRCF3                             00000006
LATA                              0000010C
LATA0                             00000000
LATA1                             00000001
LATA2                             00000002
LATA3                             00000003
LATA4                             00000004
LATA5                             00000005
LATA6                             00000006
LATA7                             00000007
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 70


SYMBOL TABLE
  LABEL                             VALUE 

LATB                              0000010D
LATB0                             00000000
LATB1                             00000001
LATB2                             00000002
LATB3                             00000003
LATB4                             00000004
LATB5                             00000005
LATB6                             00000006
LATB7                             00000007
LATC                              0000010E
LATC0                             00000000
LATC1                             00000001
LATC2                             00000002
LATC3                             00000003
LATC4                             00000004
LATC5                             00000005
LATC6                             00000006
LATC7                             00000007
LATE                              00000110
LATE3                             00000003
LCDA                              00000005
LCDCON                            00000791
LCDCST                            00000794
LCDCST0                           00000000
LCDCST1                           00000001
LCDCST2                           00000002
LCDDATA0                          000007A0
LCDDATA1                          000007A1
LCDDATA10                         000007AA
LCDDATA3                          000007A3
LCDDATA4                          000007A4
LCDDATA6                          000007A6
LCDDATA7                          000007A7
LCDDATA9                          000007A9
LCDEN                             00000007
LCDIE                             00000002
LCDIF                             00000002
LCDIRE                            00000007
LCDIRI                            00000005
LCDIRS                            00000006
LCDPS                             00000792
LCDREF                            00000793
LCDRL                             00000795
LCDSE0                            00000798
LCDSE1                            00000799
LFIOFR                            00000001
LMUX0                             00000000
LMUX1                             00000001
LP0                               00000000
LP1                               00000001
LP2                               00000002
LP3                               00000003
LRLAP0                            00000006
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 71


SYMBOL TABLE
  LABEL                             VALUE 

LRLAP1                            00000007
LRLAT0                            00000000
LRLAT1                            00000001
LRLAT2                            00000002
LRLBP0                            00000004
LRLBP1                            00000005
LWLO                              00000005
MC1OUT                            00000000
MC2OUT                            00000001
MFIOFR                            00000002
MISC_STATE                        0000007D
NOT_BOR                           00000000
NOT_DONE                          00000001
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RI                            00000002
NOT_RMCLR                         00000003
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NOT_WPUEN                         00000007
OERR                              00000001
OPTION_REG                        00000095
OSCCON                            00000099
OSCSTAT                           0000009A
OSCTUNE                           00000098
OSFIE                             00000007
OSFIF                             00000007
OSTS                              00000005
OctC2W                            
P                                 00000004
P1DC0                             00000000
P1DC1                             00000001
P1DC2                             00000002
P1DC3                             00000003
P1DC4                             00000004
P1DC5                             00000005
P1DC6                             00000006
P1M0                              00000006
P1M1                              00000007
P1RSEN                            00000007
P2BSEL                            00000004
P2DC0                             00000000
P2DC1                             00000001
P2DC2                             00000002
P2DC3                             00000003
P2DC4                             00000004
P2DC5                             00000005
P2DC6                             00000006
P2M0                              00000006
P2M1                              00000007
P2RSEN                            00000007
P3DC0                             00000000
P3DC1                             00000001
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 72


SYMBOL TABLE
  LABEL                             VALUE 

P3DC2                             00000002
P3DC3                             00000003
P3DC4                             00000004
P3DC5                             00000005
P3DC6                             00000006
P3M0                              00000006
P3M1                              00000007
P3RSEN                            00000007
PCIE                              00000006
PCL                               00000002
PCLATH                            0000000A
PCLATH_SHAD                       00000FE7
PCON                              00000096
PEIE                              00000006
PEN                               00000002
PFlashHk                          00000110
PIE1                              00000091
PIE2                              00000092
PIE3                              00000093
PIR1                              00000011
PIR2                              00000012
PIR3                              00000013
PLLR                              00000006
PORTA                             0000000C
PORTB                             0000000D
PORTC                             0000000E
PORTE                             00000010
PR2                               0000001B
PR4                               00000416
PR6                               0000041D
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSS1AC0                           00000002
PSS1AC1                           00000003
PSS1BD0                           00000000
PSS1BD1                           00000001
PSS2AC0                           00000002
PSS2AC1                           00000003
PSS2BD0                           00000000
PSS2BD1                           00000001
PSS3AC0                           00000002
PSS3AC1                           00000003
PSS3BD0                           00000000
PSS3BD1                           00000001
PSTR1CON                          00000296
PSTR2CON                          0000029D
PSTR3CON                          00000316
PWM1CON                           00000294
PWM2CON                           0000029B
PWM3CON                           00000314
QuadC2W                           
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 73


SYMBOL TABLE
  LABEL                             VALUE 

RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RA6                               00000006
RA7                               00000007
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC6                               00000006
RC7                               00000007
RCEN                              00000003
RCIDL                             00000006
RCIE                              00000005
RCIF                              00000005
RCREG                             00000199
RCSTA                             0000019D
RD                                00000000
RE3                               00000003
RSEN                              00000001
RX9                               00000006
RX9D                              00000000
RXD                               00000072
RXDcnt                            00000025
RXDl                              00000073
RXDtmp                            00000026
RXFD                              00000076
R_NOT_W                           00000002
S                                 00000003
SBCDE                             00000002
SBOREN                            00000007
SCIE                              00000005
SCKP                              00000004
SCS0                              00000000
SCS1                              00000001
SDAHT                             00000003
SE0                               00000000
SE1                               00000001
SE10                              00000002
SE11                              00000003
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 74


SYMBOL TABLE
  LABEL                             VALUE 

SE12                              00000004
SE13                              00000005
SE14                              00000006
SE15                              00000007
SE2                               00000002
SE3                               00000003
SE4                               00000004
SE5                               00000005
SE6                               00000006
SE7                               00000007
SE8                               00000000
SE9                               00000001
SEG0COM0                          00000000
SEG0COM1                          00000000
SEG0COM2                          00000000
SEG0COM3                          00000000
SEG10COM0                         00000002
SEG10COM1                         00000002
SEG10COM2                         00000002
SEG10COM3                         00000002
SEG11COM0                         00000003
SEG11COM1                         00000003
SEG11COM2                         00000003
SEG11COM3                         00000003
SEG12COM0                         00000004
SEG12COM1                         00000004
SEG12COM2                         00000004
SEG12COM3                         00000004
SEG13COM0                         00000005
SEG13COM1                         00000005
SEG13COM2                         00000005
SEG13COM3                         00000005
SEG14COM0                         00000006
SEG14COM1                         00000006
SEG14COM2                         00000006
SEG14COM3                         00000006
SEG15COM0                         00000007
SEG15COM1                         00000007
SEG15COM2                         00000007
SEG15COM3                         00000007
SEG1COM0                          00000001
SEG1COM1                          00000001
SEG1COM2                          00000001
SEG1COM3                          00000001
SEG2COM0                          00000002
SEG2COM1                          00000002
SEG2COM2                          00000002
SEG2COM3                          00000002
SEG3COM0                          00000003
SEG3COM1                          00000003
SEG3COM2                          00000003
SEG3COM3                          00000003
SEG4COM0                          00000004
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 75


SYMBOL TABLE
  LABEL                             VALUE 

SEG4COM1                          00000004
SEG4COM2                          00000004
SEG4COM3                          00000004
SEG5COM0                          00000005
SEG5COM1                          00000005
SEG5COM2                          00000005
SEG5COM3                          00000005
SEG6COM0                          00000006
SEG6COM1                          00000006
SEG6COM2                          00000006
SEG6COM3                          00000006
SEG7COM0                          00000007
SEG7COM1                          00000007
SEG7COM2                          00000007
SEG7COM3                          00000007
SEG8COM0                          00000000
SEG8COM1                          00000000
SEG8COM2                          00000000
SEG8COM3                          00000000
SEG9COM0                          00000001
SEG9COM1                          00000001
SEG9COM2                          00000001
SEG9COM3                          00000001
SEN                               00000000
SENDB                             00000003
SLPEN                             00000006
SMP                               00000007
SP1BRG                            0000019B
SP1BRGH                           0000019C
SP1BRGL                           0000019B
SPBRG                             0000019B
SPBRGH                            0000019C
SPBRGL                            0000019B
SPEN                              00000007
SPLLEN                            00000007
SRCLK0                            00000004
SRCLK1                            00000005
SRCLK2                            00000006
SRCON0                            0000011A
SRCON1                            0000011B
SREN                              00000005
SRLEN                             00000007
SRNQEN                            00000002
SRNQSEL                           00000003
SRPR                              00000000
SRPS                              00000001
SRQEN                             00000003
SRRC1E                            00000000
SRRC2E                            00000001
SRRCKE                            00000002
SRRPE                             00000003
SRSC1E                            00000004
SRSC2E                            00000005
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 76


SYMBOL TABLE
  LABEL                             VALUE 

SRSCKE                            00000006
SRSPE                             00000007
SSPADD                            00000212
SSPBUF                            00000211
SSPCON                            00000215
SSPCON1                           00000215
SSPCON2                           00000216
SSPCON3                           00000217
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPMSK                            00000213
SSPOV                             00000006
SSPSTAT                           00000214
SSSEL                             00000001
STATUS                            00000003
STATUS_SHAD                       00000FE4
STKOVF                            00000007
STKPTR                            00000FED
STKUNF                            00000006
STR1A                             00000000
STR1B                             00000001
STR1C                             00000002
STR1D                             00000003
STR1SYNC                          00000004
STR2A                             00000000
STR2B                             00000001
STR2C                             00000002
STR2D                             00000003
STR2SYNC                          00000004
STR3A                             00000000
STR3B                             00000001
STR3C                             00000002
STR3D                             00000003
STR3SYNC                          00000004
SWDTEN                            00000000
SYNC                              00000004
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T0XCS                             00000000
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000018
T1GCON                            00000019
T1GGO                             00000003
T1GGO_NOT_DONE                    00000003
T1GPOL                            00000006
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 77


SYMBOL TABLE
  LABEL                             VALUE 

T1GSEL                            00000005
T1GSPM                            00000004
T1GSS0                            00000000
T1GSS1                            00000001
T1GTM                             00000005
T1GVAL                            00000002
T1OSCEN                           00000003
T1OSCR                            00000007
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             0000001C
T2OUTPS0                          00000003
T2OUTPS1                          00000004
T2OUTPS2                          00000005
T2OUTPS3                          00000006
T4CKPS0                           00000000
T4CKPS1                           00000001
T4CON                             00000417
T4OUTPS0                          00000003
T4OUTPS1                          00000004
T4OUTPS2                          00000005
T4OUTPS3                          00000006
T6CKPS0                           00000000
T6CKPS1                           00000001
T6CON                             0000041E
T6OUTPS0                          00000003
T6OUTPS1                          00000004
T6OUTPS2                          00000005
T6OUTPS3                          00000006
TEXT_POS                          00000078
TEXT_TMP                          00000024
TMR0                              00000015
TMR0CS                            00000005
TMR0IE                            00000005
TMR0IF                            00000002
TMR0SE                            00000004
TMR1                              00000016
TMR1CS0                           00000006
TMR1CS1                           00000007
TMR1GE                            00000007
TMR1GIE                           00000007
TMR1GIF                           00000007
TMR1H                             00000017
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             00000016
TMR1ON                            00000000
TMR2                              0000001A
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TMR4                              00000415
TMR4IE                            00000001
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 78


SYMBOL TABLE
  LABEL                             VALUE 

TMR4IF                            00000001
TMR4ON                            00000002
TMR6                              0000041C
TMR6IE                            00000003
TMR6IF                            00000003
TMR6ON                            00000002
TOSH                              00000FEF
TOSL                              00000FEE
TRISA                             0000008C
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISA6                            00000006
TRISA7                            00000007
TRISB                             0000008D
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRISC                             0000008E
TRISC0                            00000000
TRISC1                            00000001
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TRISC6                            00000006
TRISC7                            00000007
TRISE                             00000090
TRISE3                            00000003
TRMT                              00000001
TSEN                              00000005
TSRNG                             00000004
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TUN5                              00000005
TX9                               00000006
TX9D                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             0000019A
TXSTA                             0000019E
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 79


SYMBOL TABLE
  LABEL                             VALUE 

TX_OUT                            0000007A
UA                                00000001
VLCD1PE                           00000001
VLCD2PE                           00000002
VLCD3PE                           00000003
W                                 00000000
WA                                00000004
WCOL                              00000007
WDTCON                            00000097
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
WDTPS4                            00000005
WERR                              00000005
WFT                               00000007
WPUB                              0000020D
WPUB0                             00000000
WPUB1                             00000001
WPUB2                             00000002
WPUB3                             00000003
WPUB4                             00000004
WPUB5                             00000005
WPUB6                             00000006
WPUB7                             00000007
WPUE                              00000210
WPUE3                             00000003
WR                                00000001
WREG                              00000009
WREG_SHAD                         00000FE5
WREN                              00000002
WRERR                             00000003
WUE                               00000001
Z                                 00000002
Z_SHAD                            00000002
_BANKSIZE                         0x80
_BOREN_NSLEEP                     00003DFF
_BOREN_OFF                        000039FF
_BOREN_ON                         00003FFF
_BOREN_SBODEN                     00003BFF
_BORV_19                          00003FFF
_BORV_25                          00003BFF
_BORV_HI                          00003BFF
_BORV_LO                          00003FFF
_CLKOUTEN_OFF                     00003FFF
_CLKOUTEN_ON                      000037FF
_CONFIG1                          00008007
_CONFIG2                          00008008
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_OFF                           00003FFF
_CP_ON                            00003F7F
_DEVID1                           00008006
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 80


SYMBOL TABLE
  LABEL                             VALUE 

_FCMEN_OFF                        00001FFF
_FCMEN_ON                         00003FFF
_FOSC_ECH                         00003FFF
_FOSC_ECL                         00003FFD
_FOSC_ECM                         00003FFE
_FOSC_EXTRC                       00003FFB
_FOSC_HS                          00003FFA
_FOSC_INTOSC                      00003FFC
_FOSC_LP                          00003FF8
_FOSC_XT                          00003FF9
_IDLOC0                           00008000
_IDLOC1                           00008001
_IDLOC2                           00008002
_IDLOC3                           00008003
_IESO_OFF                         00002FFF
_IESO_ON                          00003FFF
_LVP_OFF                          00001FFF
_LVP_ON                           00003FFF
_MCLRE_OFF                        00003FBF
_MCLRE_ON                         00003FFF
_PAGESIZE                         0x0800
_PLLEN_OFF                        00003EFF
_PLLEN_ON                         00003FFF
_PPMVERSION                       0x120
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FDF
_STVREN_OFF                       00003DFF
_STVREN_ON                        00003FFF
_VCAPEN_OFF                       00003FFF
_VCAPEN_RA0                       00003FCF
_VCAPEN_RA5                       00003FDF
_VCAPEN_RA6                       00003FEF
_WDTE_NSLEEP                      00003FF7
_WDTE_OFF                         00003FE7
_WDTE_ON                          00003FFF
_WDTE_SWDTEN                      00003FEF
_WRT_ALL                          00003FFC
_WRT_BOOT                         00003FFE
_WRT_HALF                         00003FFD
_WRT_OFF                          00003FFF
__16F1938                         00000001
add_f16_f16_f16                   
add_f16_f_f16                     
add_f16_l16_f16                   
add_f32_f16_f32                   
add_f32_f32_f32                   
add_f32_l32_f32                   
add_f8_f8_f8                      
add_f8_l8_f8                      
add_f_f_f                         
add_f_l_f                         
add_l16_f16_f16                   
add_l32_f32_f32                   
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 81


SYMBOL TABLE
  LABEL                             VALUE 

add_l8_f8_f8                      
add_l_f_f                         
addwfb                            
andwfb                            
bank_option                       00000000
bankblock                         FFFFFFFF
bankblockend                      
bankblockstart                    
banklabel                         
bankres                           
bankset                           
bcfb                              
bootloadcheck                     00000000
bsfb                              
callc                             
callp                             
callpp                            
callwp                            
cdep                              00000000
checkFlush                        00000142
checkFlushData                    00000139
clr_f                             
clr_f16                           
clr_f32                           
clr_f_b                           
clrfb                             
dec_f                             
dec_f16                           
dec_f32                           
decfb                             
del1                              00000011
delaycnt                          00000020
div_f16_f16_f16                   
div_f16_l16_f16                   
div_f32_f32_f32                   
div_f32_l32_f32                   
div_f8_f8_f8                      
div_f8_l8_f8                      
div_f_f_f                         
div_f_l_f                         
div_l16_f16_f16                   
div_l32_f32_f32                   
div_l8_f8_f8                      
div_l_f_f                         
divr_f16_f16_f16_f16              
divr_f16_l16_f16_f16              
divr_f32_f32_f32_f32              
divr_f32_l32_f32_f32              
divr_f8_f8_f8_f8                  
divr_f8_l8_f8_f8                  
divr_f_f_f_f                      
divr_f_l_f_f                      
divr_l16_f16_f16_f16              
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 82


SYMBOL TABLE
  LABEL                             VALUE 

divr_l32_f32_f32_f32              
divr_l8_f8_f8_f8                  
divr_l_f_f_f                      
else_                             
else_if                           
end_if                            
end_while                         
erasePFlash                       0000010E
f16_f16_add_f                     
f16_f16_add_f16                   
f16_f16_add_l16                   
f16_f16_div_f16                   
f16_f16_div_l16                   
f16_f16_f16_divr_f16              
f16_f16_f16_divr_l16              
f16_f16_l16_divr_f16              
f16_f16_mul10                     
f16_f16_mul_f16                   
f16_f16_mul_l16                   
f16_f16_rem_f16                   
f16_f16_rem_l16                   
f16_f16_sub_f16                   
f16_f16_sub_l16                   
f16_f8_mul_f8                     
f16_f8_mul_l8                     
f16_l16_add_f16                   
f16_l16_div_f16                   
f16_l16_mul_f16                   
f16_l16_rem_f16                   
f16_l16_sub_f16                   
f16_l8_mul_f8                     
f32_f16_mul_f16                   
f32_f16_mul_l16                   
f32_f32_add_f16                   
f32_f32_add_f32                   
f32_f32_add_l32                   
f32_f32_div_f32                   
f32_f32_div_l32                   
f32_f32_f32_divr_f32              
f32_f32_f32_divr_l32              
f32_f32_l32_divr_f32              
f32_f32_mul10                     
f32_f32_mul_f32                   
f32_f32_mul_l32                   
f32_f32_rem_f32                   
f32_f32_rem_l32                   
f32_f32_sub_f32                   
f32_f32_sub_l32                   
f32_l16_mul_f16                   
f32_l32_add_f32                   
f32_l32_div_f32                   
f32_l32_mul_f32                   
f32_l32_rem_f32                   
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 83


SYMBOL TABLE
  LABEL                             VALUE 

f32_l32_sub_f32                   
f8_f8_add_f8                      
f8_f8_add_l8                      
f8_f8_div_f8                      
f8_f8_div_l8                      
f8_f8_f8_divr_f8                  
f8_f8_f8_divr_l8                  
f8_f8_l8_divr_f8                  
f8_f8_mul10                       
f8_f8_mul_f8                      
f8_f8_mul_l8                      
f8_f8_rem_f8                      
f8_f8_rem_l8                      
f8_f8_sub_f8                      
f8_f8_sub_l8                      
f8_l8_add_f8                      
f8_l8_div_f8                      
f8_l8_mul_f8                      
f8_l8_rem_f8                      
f8_l8_sub_f8                      
f_f_add_f                         
f_f_add_l                         
f_f_div_f                         
f_f_div_l                         
f_f_f_divr_f                      
f_f_f_divr_l                      
f_f_l_divr_f                      
f_f_mul10                         
f_f_mul_f                         
f_f_mul_l                         
f_f_rem_f                         
f_f_rem_l                         
f_f_sub_f                         
f_f_sub_l                         
f_l_add_f                         
f_l_div_f                         
f_l_mul_f                         
f_l_rem_f                         
f_l_sub_f                         
fakereadadr                       0000002B
for_f16_f16_f16                   
for_f16_f16_l16                   
for_f16_l16_f16                   
for_f16_l16_l16                   
for_f32_f32_f32                   
for_f32_f32_l32                   
for_f32_l32_f32                   
for_f32_l32_l32                   
for_f8_f8_f8                      
for_f8_f8_l8                      
for_f8_l8_f8                      
for_f8_l8_l8                      
for_f_f_f                         
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 84


SYMBOL TABLE
  LABEL                             VALUE 

for_f_f_l                         
for_f_l_f                         
for_f_l_l                         
ford_f16_f16_f16                  
ford_f16_f16_l16                  
ford_f16_l16_f16                  
ford_f16_l16_l16                  
ford_f32_f32_f32                  
ford_f32_f32_l32                  
ford_f32_l32_f32                  
ford_f32_l32_l32                  
ford_f8_f8_f8                     
ford_f8_f8_l8                     
ford_f8_l8_f8                     
ford_f8_l8_l8                     
ford_f_f_f                        
ford_f_f_l                        
ford_f_l_f                        
ford_f_l_l                        
gotoc                             
gotoif_f16_eq_f16                 
gotoif_f16_eq_l16                 
gotoif_f16_ge_f16                 
gotoif_f16_ge_l16                 
gotoif_f16_gt_f16                 
gotoif_f16_gt_l16                 
gotoif_f16_le_f16                 
gotoif_f16_le_l16                 
gotoif_f16_lt_f16                 
gotoif_f16_lt_l16                 
gotoif_f16_ne_f16                 
gotoif_f16_ne_l16                 
gotoif_f32_eq_f32                 
gotoif_f32_eq_l32                 
gotoif_f32_ge_f32                 
gotoif_f32_ge_l32                 
gotoif_f32_gt_f32                 
gotoif_f32_gt_l32                 
gotoif_f32_le_f32                 
gotoif_f32_le_l32                 
gotoif_f32_lt_f32                 
gotoif_f32_lt_l32                 
gotoif_f32_ne_f32                 
gotoif_f32_ne_l32                 
gotoif_f8_b_c                     
gotoif_f8_b_s                     
gotoif_f8_eq_f8                   
gotoif_f8_eq_l8                   
gotoif_f8_ge_f8                   
gotoif_f8_ge_l8                   
gotoif_f8_gt_f8                   
gotoif_f8_gt_l8                   
gotoif_f8_le_f8                   
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 85


SYMBOL TABLE
  LABEL                             VALUE 

gotoif_f8_le_l8                   
gotoif_f8_lt_f8                   
gotoif_f8_lt_l8                   
gotoif_f8_msk_eq_f8               
gotoif_f8_msk_msk_eq_l8           
gotoif_f8_msk_ne_f8               
gotoif_f8_msk_ne_l8               
gotoif_f8_ne_f8                   
gotoif_f8_ne_l8                   
gotoif_f_b_c                      
gotoif_f_b_s                      
gotoif_f_eq_f                     
gotoif_f_eq_l                     
gotoif_f_ge_f                     
gotoif_f_ge_l                     
gotoif_f_gt_f                     
gotoif_f_gt_l                     
gotoif_f_le_f                     
gotoif_f_le_l                     
gotoif_f_lt_f                     
gotoif_f_lt_l                     
gotoif_f_msk_eq_f                 
gotoif_f_msk_eq_l                 
gotoif_f_msk_ne_f                 
gotoif_f_msk_ne_l                 
gotoif_f_ne_f                     
gotoif_f_ne_l                     
gotop                             
gotopp                            
hextobin                          000001B3
if_f16_eq_f16                     
if_f16_eq_l16                     
if_f16_ge_f16                     
if_f16_ge_l16                     
if_f16_gt_f16                     
if_f16_gt_l16                     
if_f16_le_f16                     
if_f16_le_l16                     
if_f16_lt_f16                     
if_f16_lt_l16                     
if_f16_ne_f16                     
if_f16_ne_l16                     
if_f32_eq_f32                     
if_f32_eq_l32                     
if_f32_ge_f32                     
if_f32_ge_l32                     
if_f32_gt_f32                     
if_f32_gt_l32                     
if_f32_le_f32                     
if_f32_le_l32                     
if_f32_lt_f32                     
if_f32_lt_l32                     
if_f32_ne_f32                     
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 86


SYMBOL TABLE
  LABEL                             VALUE 

if_f32_ne_l32                     
if_f_b_c                          
if_f_b_s                          
if_f_eq_f                         
if_f_eq_l                         
if_f_ge_f                         
if_f_ge_l                         
if_f_gt_f                         
if_f_gt_l                         
if_f_le_f                         
if_f_le_l                         
if_f_lt_f                         
if_f_lt_l                         
if_f_msk_eq_f                     
if_f_msk_eq_l                     
if_f_msk_ne_f                     
if_f_msk_ne_l                     
if_f_ne_f                         
if_f_ne_l                         
inc_f                             
inc_f16                           
inc_f32                           
incfb                             
init2                             00000006
init3                             00000019
intvector                         00000004
iorwfb                            
jcnt                              00000000
kcnt                              00000000
lab_1_1                           00000040
lab_1_10                          00000104
lab_1_11                          00000154
lab_1_12                          0000017F
lab_1_13                          000001B7
lab_1_14                          000001C9
lab_1_15                          000001CB
lab_1_2                           00000054
lab_1_3                           0000005A
lab_1_4                           00000065
lab_1_5                           000000CD
lab_1_6                           000000D3
lab_1_7                           000000DB
lab_1_8                           000000E7
lab_1_9                           000000F8
lab_2_1                           00000103
lab_2_2                           00000104
lab_2_3                           0000017F
labcnt1                           0000000F
labcnt2                           00000003
load_eeadr                        00000159
load_f16_f16                      
load_f16_f16_add_f                
load_f16_f16_add_f16              
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 87


SYMBOL TABLE
  LABEL                             VALUE 

load_f16_f16_add_l16              
load_f16_f16_div_f16              
load_f16_f16_div_l16              
load_f16_f16_f16_divr_f16         
load_f16_f16_f16_divr_l16         
load_f16_f16_l16_divr_f16         
load_f16_f16_mul10                
load_f16_f16_mul_f16              
load_f16_f16_mul_l16              
load_f16_f16_rem_f16              
load_f16_f16_rem_l16              
load_f16_f16_sub_f16              
load_f16_f16_sub_l16              
load_f16_f32                      
load_f16_f8                       
load_f16_f8_mul_f8                
load_f16_f8_mul_l8                
load_f16_i8                       
load_f16_l16                      
load_f16_l16_add_f16              
load_f16_l16_div_f16              
load_f16_l16_mul_f16              
load_f16_l16_rem_f16              
load_f16_l16_sub_f16              
load_f16_l8_mul_f8                
load_f16_x8_z8                    
load_f32_f16                      
load_f32_f16_mul_f16              
load_f32_f16_mul_l16              
load_f32_f32                      
load_f32_f32_add_f16              
load_f32_f32_add_f32              
load_f32_f32_add_l32              
load_f32_f32_div_f32              
load_f32_f32_div_l32              
load_f32_f32_f32_divr_f32         
load_f32_f32_f32_divr_l32         
load_f32_f32_l32_divr_f32         
load_f32_f32_mul10                
load_f32_f32_mul_f32              
load_f32_f32_mul_l32              
load_f32_f32_rem_f32              
load_f32_f32_rem_l32              
load_f32_f32_sub_f32              
load_f32_f32_sub_l32              
load_f32_f8                       
load_f32_i8                       
load_f32_l16_mul_f16              
load_f32_l32                      
load_f32_l32_add_f32              
load_f32_l32_div_f32              
load_f32_l32_mul_f32              
load_f32_l32_rem_f32              
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 88


SYMBOL TABLE
  LABEL                             VALUE 

load_f32_l32_sub_f32              
load_f32_x8_z8                    
load_f8_b_f8_b                    
load_f8_b_i8_b                    
load_f8_b_il8_b                   
load_f8_f16                       
load_f8_f32                       
load_f8_f8                        
load_f8_f8_add_f8                 
load_f8_f8_add_l8                 
load_f8_f8_div_f8                 
load_f8_f8_div_l8                 
load_f8_f8_f8_divr_f8             
load_f8_f8_f8_divr_l8             
load_f8_f8_l8_divr_f8             
load_f8_f8_mul10                  
load_f8_f8_mul_f8                 
load_f8_f8_mul_l8                 
load_f8_f8_rem_f8                 
load_f8_f8_rem_l8                 
load_f8_f8_sub_f8                 
load_f8_f8_sub_l8                 
load_f8_i8                        
load_f8_il8                       
load_f8_l8                        
load_f8_l8_add_f8                 
load_f8_l8_div_f8                 
load_f8_l8_mul_f8                 
load_f8_l8_rem_f8                 
load_f8_l8_sub_f8                 
load_f8_x8_z8                     
load_f_b_f_b                      
load_f_b_i_b                      
load_f_b_il_b                     
load_f_b_l                        
load_f_f                          
load_f_f_add_f                    
load_f_f_add_l                    
load_f_f_div_f                    
load_f_f_div_l                    
load_f_f_f_divr_f                 
load_f_f_f_divr_l                 
load_f_f_l_divr_f                 
load_f_f_mul10                    
load_f_f_mul_f                    
load_f_f_mul_l                    
load_f_f_rem_f                    
load_f_f_rem_l                    
load_f_f_sub_f                    
load_f_f_sub_l                    
load_f_i                          
load_f_il                         
load_f_l                          
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 89


SYMBOL TABLE
  LABEL                             VALUE 

load_f_l_add_f                    
load_f_l_div_f                    
load_f_l_mul_f                    
load_f_l_rem_f                    
load_f_l_sub_f                    
load_f_w                          
load_f_x_z                        
load_i8_b_f8_b                    
load_i8_b_i8_b                    
load_i8_b_il8_b                   
load_i8_f16                       
load_i8_f32                       
load_i8_f8                        
load_i8_i8                        
load_i8_il8                       
load_i8_l16                       
load_i8_l32                       
load_i8_l8                        
load_i_b_f_b                      
load_i_b_i_b                      
load_i_b_il_b                     
load_i_f                          
load_i_i                          
load_i_il                         
load_i_l                          
load_i_w                          
load_il8_b_f8_b                   
load_il8_b_i8_b                   
load_il8_b_il8_b                  
load_il8_f8                       
load_il8_i8                       
load_il8_il8                      
load_il8_l8                       
load_il_b_f_b                     
load_il_b_i_b                     
load_il_b_il_b                    
load_il_f                         
load_il_i                         
load_il_il                        
load_il_l                         
load_w_f                          
load_w_i                          
load_w_l                          
load_x8_z8_f16                    
load_x8_z8_f32                    
load_x8_z8_f8                     
load_x8_z8_l16                    
load_x8_z8_l32                    
load_x8_z8_l8                     
load_x_z_f                        
load_x_z_l                        
loadl_f8_i16                      
loadl_f8_i8                       
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 90


SYMBOL TABLE
  LABEL                             VALUE 

loadl_f_i                         
loadl_f_i16                       
loadl_i16_f                       
loadl_i16_f8                      
loadl_i16_l                       
loadl_i16_l8                      
loadl_i8_f8                       
loadl_i8_l8                       
loadl_i_f                         
loadl_i_l                         
loadl_i_w                         
loadl_w_i                         
loadnb_f_f                        
loadnb_f_l                        
lslfb                             
lsrfb                             
mainloop                          0000002A
mcnt                              00000000
mdep                              00000002
move_f16_f16                      
move_f16_f32                      
move_f16_f8                       
move_f16_i8                       
move_f16_l16                      
move_f16_x8_z8                    
move_f32_f16                      
move_f32_f32                      
move_f32_f8                       
move_f32_i8                       
move_f32_x8_z8                    
move_f8_b_f8_b                    
move_f8_b_i8_b                    
move_f8_b_il8_b                   
move_f8_f16                       
move_f8_f32                       
move_f8_f8                        
move_f8_i8                        
move_f8_il8                       
move_f8_x8_z8                     
move_f_b_f_b                      
move_f_b_i_b                      
move_f_b_il_b                     
move_f_f                          
move_f_i                          
move_f_il                         
move_f_w                          
move_f_x_z                        
move_i8_b_f8_b                    
move_i8_b_i8_b                    
move_i8_b_il8_b                   
move_i8_f16                       
move_i8_f32                       
move_i8_f8                        
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 91


SYMBOL TABLE
  LABEL                             VALUE 

move_i8_i8                        
move_i8_il8                       
move_i_b_f_b                      
move_i_b_i_b                      
move_i_b_il_b                     
move_i_f                          
move_i_i                          
move_i_il                         
move_i_w                          
move_il8_b_f8_b                   
move_il8_b_i8_b                   
move_il8_b_il8_b                  
move_il8_f                        
move_il8_f8                       
move_il8_i8                       
move_il8_il8                      
move_il_b_f_b                     
move_il_b_i_b                     
move_il_b_il_b                    
move_il_i                         
move_il_il                        
move_l16_i8                       
move_l16_x8_z8                    
move_l32_f32                      
move_l32_i8                       
move_l32_x8_z8                    
move_l8_f8                        
move_l8_i8                        
move_l8_il8                       
move_l8_x8_z8                     
move_l_f                          
move_l_i                          
move_l_il                         
move_l_w                          
move_l_x_z                        
move_w_f                          
move_w_i                          
move_x8_z8_f16                    
move_x8_z8_f32                    
move_x8_z8_f8                     
move_x_z_f                        
movel_f8_i16                      
movel_f8_i8                       
movel_f_i                         
movel_f_i16                       
movel_i16_f                       
movel_i16_f8                      
movel_i8_f8                       
movel_i_f                         
movel_i_w                         
movel_l8_i16                      
movel_l8_i8                       
movel_l_i                         
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 92


SYMBOL TABLE
  LABEL                             VALUE 

movel_l_i16                       
movel_w_i                         
mul10_f16_f16                     
mul10_f32_f32                     
mul10_f8_f8                       
mul10_f_f                         
mul_f16_f16_f16                   
mul_f16_f16_f32                   
mul_f16_l16_f16                   
mul_f16_l16_f32                   
mul_f32_f32_f32                   
mul_f32_l32_f32                   
mul_f8_f8_f16                     
mul_f8_f8_f8                      
mul_f8_l8_f16                     
mul_f8_l8_f8                      
mul_f_f_f                         
mul_f_l_f                         
mul_l16_f16_f16                   
mul_l16_f16_f32                   
mul_l32_f32_f32                   
mul_l8_f8_f16                     
mul_l8_f8_f8                      
mul_l_f_f                         
next                              
next_f                            
next_f16                          
next_f32                          
next_f8                           
page_option                       00000000
pageres                           
pageset                           
pgcnt                             00000016
rdp1                              0000006C
rdp2                              00000084
rdp3                              0000009F
rdp4                              00000096
readPFlash                        00000105
readPFlash_ld                     00000107
readRXwait                        00000165
readhexbyteRXwait                 00000189
readhexfile                       000000A2
readprogram                       00000066
rem_f16_f16_f16                   
rem_f16_l16_f16                   
rem_f32_f32_f32                   
rem_f32_l32_f32                   
rem_f8_f8_f8                      
rem_f8_l8_f8                      
rem_f_f_f                         
rem_f_l_f                         
rem_l16_f16_f16                   
rem_l32_f32_f32                   
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 93


SYMBOL TABLE
  LABEL                             VALUE 

rem_l8_f8_f8                      
rem_l_f_f                         
repeat                            
rhf1                              000000DB
rhf2                              000000A9
rhf3                              000000F8
rhf4                              000000A9
rhf5                              000000F4
rlfb                              
rrfb                              
rrxw1                             0000016A
rrxw2                             00000165
rrxw3                             00000173
set_f_b                           
sub_f16_f16_f16                   
sub_f16_l16_f16                   
sub_f32_f32_f32                   
sub_f32_l32_f32                   
sub_f8_f8_f8                      
sub_f8_l8_f8                      
sub_f_f_f                         
sub_f_l_f                         
sub_l16_f16_f16                   
sub_l32_f32_f32                   
sub_l8_f8_f8                      
sub_l_f_f                         
subwf_b                           
swapfb                            
text_OK                           000001FA
text_bye                          000001FC
text_errors                       000001F2
text_hexfile                      000001E5
text_menu                         000001D3
uart_write_TX_OUT                 0000015E
uart_write_f                      
uart_write_l                      
uart_write_w                      0000015F
until_f16_eq_f16                  
until_f16_eq_l16                  
until_f16_ge_f16                  
until_f16_ge_l16                  
until_f16_gt_f16                  
until_f16_gt_l16                  
until_f16_le_f16                  
until_f16_le_l16                  
until_f16_lt_f16                  
until_f16_lt_l16                  
until_f16_ne_f16                  
until_f16_ne_l16                  
until_f32_eq_f32                  
until_f32_eq_l32                  
until_f32_ge_f32                  
until_f32_ge_l32                  
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 94


SYMBOL TABLE
  LABEL                             VALUE 

until_f32_gt_f32                  
until_f32_gt_l32                  
until_f32_le_f32                  
until_f32_le_l32                  
until_f32_lt_f32                  
until_f32_lt_l32                  
until_f32_ne_f32                  
until_f32_ne_l32                  
until_f8_b_c                      
until_f8_b_s                      
until_f8_eq_f8                    
until_f8_eq_l8                    
until_f8_ge_f8                    
until_f8_ge_l8                    
until_f8_gt_f8                    
until_f8_gt_l8                    
until_f8_le_f8                    
until_f8_le_l8                    
until_f8_lt_f8                    
until_f8_lt_l8                    
until_f8_ne_f8                    
until_f8_ne_l8                    
until_f_b_c                       
until_f_b_s                       
until_f_eq_f                      
until_f_eq_l                      
until_f_ge_f                      
until_f_ge_l                      
until_f_gt_f                      
until_f_gt_l                      
until_f_le_f                      
until_f_le_l                      
until_f_lt_f                      
until_f_lt_l                      
until_f_ne_f                      
until_f_ne_l                      
wh1                               000001BA
while_f16_eq_f16                  
while_f16_eq_l16                  
while_f16_ge_f16                  
while_f16_ge_l16                  
while_f16_gt_f16                  
while_f16_gt_l16                  
while_f16_le_f16                  
while_f16_le_l16                  
while_f16_lt_f16                  
while_f16_lt_l16                  
while_f16_ne_f16                  
while_f16_ne_l16                  
while_f32_eq_f32                  
while_f32_eq_l32                  
while_f32_ge_f32                  
while_f32_ge_l32                  
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 95


SYMBOL TABLE
  LABEL                             VALUE 

while_f32_gt_f32                  
while_f32_gt_l32                  
while_f32_le_f32                  
while_f32_le_l32                  
while_f32_lt_f32                  
while_f32_lt_l32                  
while_f32_ne_f32                  
while_f32_ne_l32                  
while_f8_eq_f8                    
while_f8_eq_l8                    
while_f8_ge_f8                    
while_f8_ge_l8                    
while_f8_gt_f8                    
while_f8_gt_l8                    
while_f8_le_f8                    
while_f8_le_l8                    
while_f8_lt_f8                    
while_f8_lt_l8                    
while_f8_ne_f8                    
while_f8_ne_l8                    
while_f_eq_f                      
while_f_eq_l                      
while_f_ge_f                      
while_f_ge_l                      
while_f_gt_f                      
while_f_gt_l                      
while_f_le_f                      
while_f_le_l                      
while_f_lt_f                      
while_f_lt_l                      
while_f_ne_f                      
while_f_ne_l                      
wpf1                              00000135
writePFlash                       0000011E
writeRXDtoflash                   0000014F
write_hex                         000001BA
write_hex_n                       000001C0
write_lf                          000001CD
write_space                       000001D0
write_text                        00000192
writetext                         
xorwfb                            
MPASM 5.67                BOOTLOADER_V10.ASM   6-18-2016  16:15:18         PAGE 96


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


0000 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
01C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXX-
8000 : -------XX------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:   513
Program Memory Words Free: 15871


Errors   :     0
Warnings :     2 reported,     0 suppressed
Messages :    29 reported,     7 suppressed

